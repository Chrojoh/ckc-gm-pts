<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CKC Grand Master Points Tracker - PDF Upload</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script>
        // Configure PDF.js worker
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .import-section {
            padding: 30px;
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
        }

        .import-methods {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .import-method {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            border: 2px solid transparent;
            transition: all 0.3s;
            cursor: pointer;
        }

        .import-method:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .import-method.active {
            background: rgba(255, 255, 255, 0.2);
            border-color: #e74c3c;
        }

        .method-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            display: block;
        }

        .method-title {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .method-description {
            opacity: 0.9;
            line-height: 1.5;
        }

        .input-area {
            margin-top: 30px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 25px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: white;
        }

        .input-field {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
        }

        .file-upload-area {
            border: 2px dashed rgba(255, 255, 255, 0.5);
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            background: rgba(255, 255, 255, 0.05);
            transition: all 0.3s;
            cursor: pointer;
        }

        .file-upload-area:hover {
            border-color: rgba(255, 255, 255, 0.8);
            background: rgba(255, 255, 255, 0.1);
        }

        .file-upload-area.dragover {
            border-color: #e74c3c;
            background: rgba(231, 76, 60, 0.1);
        }

        .upload-icon {
            font-size: 4rem;
            margin-bottom: 15px;
            opacity: 0.7;
        }

        .upload-text {
            font-size: 1.2rem;
            margin-bottom: 10px;
        }

        .upload-subtext {
            opacity: 0.8;
            font-size: 0.9rem;
        }

        .file-input {
            display: none;
        }

        .btn-primary {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: transform 0.2s;
            width: 100%;
            margin-top: 15px;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .processing-status {
            display: none;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 12px;
            padding: 30px;
            margin: 20px 0;
            text-align: center;
            color: #2c3e50;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .workflow-steps {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
        }

        .workflow-steps h4 {
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .workflow-steps ol {
            padding-left: 20px;
            line-height: 1.8;
        }

        .workflow-steps li {
            margin-bottom: 8px;
        }

        .tabs {
            display: flex;
            background: #34495e;
            border-bottom: 3px solid #2c3e50;
        }

        .tab {
            flex: 1;
            padding: 15px 20px;
            background: #34495e;
            color: white;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s;
            border-right: 1px solid #2c3e50;
        }

        .tab:hover {
            background: #3498db;
        }

        .tab.active {
            background: #2c3e50;
            box-shadow: inset 0 3px 0 #e74c3c;
        }

        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 350px 1fr 350px;
            gap: 30px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            border: 1px solid #e0e6ed;
        }

        .points-display {
            background: linear-gradient(135deg, #27ae60, #229954);
            color: white;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 20px;
        }

        .points-number {
            font-size: 3.5rem;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .dog-info {
            background: linear-gradient(135deg, #6f42c1, #563d7c);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .success-message {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            margin: 15px 0;
            display: none;
        }

        .error-message {
            background: linear-gradient(135deg, #dc3545, #c82333);
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            margin: 15px 0;
            display: none;
        }

        .pdf-preview {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            display: none;
        }

        .pdf-info {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .pdf-icon {
            font-size: 2rem;
            color: #dc3545;
        }

        .extracted-text-preview {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 15px;
            max-height: 200px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            white-space: pre-wrap;
        }

        @media (max-width: 1200px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üèÜ CKC Grand Master Points Tracker</h1>
            <p>Upload CanuckDogs PDF Reports for Automatic Points Calculation</p>
        </div>

        <div class="import-section">
            <h2>üìä Choose Your Data Import Method</h2>
            <p style="margin-bottom: 20px; opacity: 0.9;">
                Select how you want to import your dog's competition data for points calculation
            </p>

            <div class="import-methods">
                <div class="import-method active" onclick="selectMethod('pdf')">
                    <div class="method-icon">üìÑ</div>
                    <div class="method-title">Upload CanuckDogs PDF</div>
                    <div class="method-description">
                        Upload PDF files generated from CanuckDogs' "Print Page" feature. 
                        Perfect for complete competition histories.
                    </div>
                </div>

                <div class="import-method" onclick="selectMethod('paste')">
                    <div class="method-icon">üìã</div>
                    <div class="method-title">Paste Text Data</div>
                    <div class="method-description">
                        Copy and paste competition data directly from CanuckDogs pages. 
                        Quick and reliable for current data.
                    </div>
                </div>

                <div class="import-method" onclick="selectMethod('demo')">
                    <div class="method-icon">üéØ</div>
                    <div class="method-title">Try Demo Data</div>
                    <div class="method-description">
                        Load sample competition data to explore features and see 
                        how championship points are calculated.
                    </div>
                </div>
            </div>

            <div class="input-area">
                <!-- PDF Upload Method -->
                <div id="pdf-method" class="method-content">
                    <div class="input-group">
                        <label>Dog's Registered Name:</label>
                        <input type="text" id="dogName" class="input-field" placeholder="Enter the registered name..." />
                    </div>

                    <div class="file-upload-area" onclick="document.getElementById('pdfInput').click()" 
                         ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)">
                        <div class="upload-icon">üìÑ</div>
                        <div class="upload-text">Drop CanuckDogs PDF here or click to browse</div>
                        <div class="upload-subtext">Supports PDF files from CanuckDogs "Print Page" feature</div>
                    </div>
                    <input type="file" id="pdfInput" class="file-input" accept=".pdf" onchange="handleFileSelect(event)" />

                    <div class="workflow-steps">
                        <h4>üìã CanuckDogs PDF Workflow:</h4>
                        <ol>
                            <li><strong>Go to CanuckDogs.ca</strong> and search for your dog</li>
                            <li><strong>Click the dog's name</strong> to open their page</li>
                            <li><strong>Click "Print Page"</strong> tab</li>
                            <li><strong>Select:</strong> Event Type = Conformation, Year = Current year</li>
                            <li><strong>Click "Print"</strong> ‚Üí Save as PDF (skip first 3 pages)</li>
                            <li><strong>Upload the PDF</strong> here for automatic processing</li>
                        </ol>
                    </div>
                </div>

                <!-- Paste Method -->
                <div id="paste-method" class="method-content" style="display: none;">
                    <div class="input-group">
                        <label>Dog's Registered Name:</label>
                        <input type="text" id="dogNamePaste" class="input-field" placeholder="Enter the registered name..." />
                    </div>

                    <div class="input-group">
                        <label>CanuckDogs Competition Data:</label>
                        <textarea id="pasteData" class="input-field" style="height: 200px; font-family: monospace;" 
                                placeholder="Copy and paste the competition data from CanuckDogs..."></textarea>
                    </div>

                    <button onclick="processPastedData()" class="btn-primary">
                        üìä Calculate Points from Pasted Data
                    </button>
                </div>

                <!-- Demo Method -->
                <div id="demo-method" class="method-content" style="display: none;">
                    <div style="text-align: center; padding: 20px;">
                        <h3 style="margin-bottom: 15px;">üéØ Try the Demo</h3>
                        <p style="margin-bottom: 20px; opacity: 0.9;">
                            Load sample data for "Miller" - a Portuguese Water Dog with multiple championship wins
                        </p>
                        <button onclick="loadDemoData()" class="btn-primary" style="max-width: 300px;">
                            üöÄ Load Demo Data
                        </button>
                    </div>
                </div>

                <div class="processing-status" id="processingStatus">
                    <div class="spinner"></div>
                    <div id="statusText">Processing PDF and extracting competition data...</div>
                </div>

                <div class="success-message" id="successMessage"></div>
                <div class="error-message" id="errorMessage"></div>

                <div class="pdf-preview" id="pdfPreview">
                    <div class="pdf-info">
                        <div class="pdf-icon">üìÑ</div>
                        <div>
                            <div style="font-weight: bold;" id="pdfFileName"></div>
                            <div style="color: #666; font-size: 0.9rem;" id="pdfFileSize"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 10px; font-weight: bold;">Extracted Text Preview:</div>
                    <div class="extracted-text-preview" id="extractedTextPreview"></div>
                </div>
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('dashboard')">üìä Points Dashboard</button>
            <button class="tab" onclick="showTab('yearly')">üìÖ Year-by-Year</button>
            <button class="tab" onclick="showTab('validation')">‚úÖ Data Quality</button>
            <button class="tab" onclick="showTab('reports')">üìÑ Export Reports</button>
        </div>

        <div id="dashboard" class="tab-content active">
            <div class="dashboard-grid">
                <div class="card">
                    <div id="dogInfo" class="dog-info" style="display: none;">
                        <h3 id="dogTitle">Dog Name</h3>
                        <p id="dogDetails">Upload or enter competition data to view championship points</p>
                    </div>

                    <div class="points-display">
                        <h3>Total Grand Master Points</h3>
                        <div class="points-number" id="totalPoints">0</div>
                        <small>Lifetime Total</small>
                    </div>
                </div>

                <div class="card">
                    <h2>üèÜ Recent Show Results</h2>
                    <div id="recentResults">
                        <p style="text-align: center; color: #666; padding: 40px;">
                            Import competition data to see championship point calculations
                        </p>
                    </div>
                </div>

                <div class="card">
                    <h2>üìà Points Summary</h2>
                    <div id="pointsSummary">
                        <div style="text-align: center; color: #666; padding: 40px;">
                            <p>Points breakdown will appear here after processing data</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="yearly" class="tab-content">
            <p style="text-align: center; color: #666; padding: 40px;">
                Year-by-year progression will appear here after processing data
            </p>
        </div>

        <div id="validation" class="tab-content">
            <p style="text-align: center; color: #666; padding: 40px;">
                Data quality validation will appear here after processing
            </p>
        </div>

        <div id="reports" class="tab-content">
            <div style="text-align: center; padding: 40px;">
                <h2>üìä Generate Reports</h2>
                <p style="margin: 20px 0;">Export comprehensive championship points reports</p>
                <button class="btn-primary" style="max-width: 300px;" disabled>
                    üìÑ Generate Championship Report
                </button>
            </div>
        </div>
    </div>

    <script>
        let currentDogData = null;
        let currentMethod = 'pdf';

        function selectMethod(method) {
            currentMethod = method;
            
            // Update visual selection
            document.querySelectorAll('.import-method').forEach(el => el.classList.remove('active'));
            event.target.closest('.import-method').classList.add('active');
            
            // Show/hide method content
            document.querySelectorAll('.method-content').forEach(el => el.style.display = 'none');
            document.getElementById(method + '-method').style.display = 'block';
        }

        // PDF Upload Handlers
        function handleDragOver(e) {
            e.preventDefault();
            e.stopPropagation();
            e.target.closest('.file-upload-area').classList.add('dragover');
        }

        function handleDragLeave(e) {
            e.preventDefault();
            e.stopPropagation();
            e.target.closest('.file-upload-area').classList.remove('dragover');
        }

        function handleDrop(e) {
            e.preventDefault();
            e.stopPropagation();
            e.target.closest('.file-upload-area').classList.remove('dragover');
            
            const files = e.dataTransfer.files;
            if (files.length > 0 && files[0].type === 'application/pdf') {
                processFile(files[0]);
            } else {
                showError('Please drop a PDF file');
            }
        }

        function handleFileSelect(e) {
            const file = e.target.files[0];
            if (file && file.type === 'application/pdf') {
                processFile(file);
            } else {
                showError('Please select a PDF file');
            }
        }

        async function processFile(file) {
            const dogName = document.getElementById('dogName').value.trim();
            if (!dogName) {
                showError('Please enter the dog\'s registered name first');
                return;
            }

            showProcessing('Processing PDF and extracting competition data...');
            
            try {
                // Show PDF preview
                showPDFPreview(file);
                
                // Simulate PDF processing (in reality, you'd use PDF.js or similar)
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                // For demo purposes, we'll simulate extracted text
                const extractedText = await simulatePDFExtraction(file, dogName);
                
                // Update preview with extracted text
                document.getElementById('extractedTextPreview').textContent = extractedText;
                
                // Parse the extracted text
                const parsedData = parseCanuckDogsText(dogName, extractedText);
                
                if (parsedData) {
                    currentDogData = parsedData;
                    calculateAllPoints();
                    displayResults();
                    showSuccess(`Successfully processed PDF for ${currentDogData.basicInfo.callName}! Found ${getTotalShows()} shows.`);
                } else {
                    showError('Could not parse competition data from PDF. Please check the file format.');
                }
                
            } catch (error) {
                showError('Error processing PDF: ' + error.message);
            } finally {
                hideProcessing();
            }
        }

        function showPDFPreview(file) {
            document.getElementById('pdfPreview').style.display = 'block';
            document.getElementById('pdfFileName').textContent = file.name;
            document.getElementById('pdfFileSize').textContent = `${(file.size / 1024 / 1024).toFixed(2)} MB`;
        }

        async function simulatePDFExtraction(file, dogName) {
            // This simulates what would be extracted from a CanuckDogs PDF
            // In a real implementation, you'd use PDF.js or a similar library
            
            const samplePDFText = `
${dogName}
Owner: Sample Owner
Breed: Portuguese Water Dog

Competition Results - Conformation Events

Calgary Kennel & Obedience Club
May 10 to May 12, 2024
Saturday    Group 1st         Joan Luna Liebes       64
Saturday    Best Of Breed     Joan Luna Liebes        0
Sunday      Best Of Breed     Eric Liebes (Dr)        0

Hub City Kennel & Obedience Club  
May 03 to May 05, 2024
Sunday      Group 3rd         Darryl Vice           44
Sunday      Best Of Breed     Darryl Vice      8(1-2-3-3)

Regina Kennel & Obedience Club
May 18 to May 19, 2024
Saturday    Best Of Breed     Honey Glendinning  4 (1-1-2-1)
Saturday    Select Dog        Sharon Derrick         N/A
Sunday      Best Of Breed     Tannis Postma      4 (1-1-2-1)
Sunday      Group 3rd         Tannis Postma          13

Battle River Canine Association
March 22 to March 24, 2024
Sunday      Group 3rd         Mario Knoll            49
            `;
            
            return samplePDFText;
        }

        async function processPastedData() {
            const dogName = document.getElementById('dogNamePaste').value.trim();
            const pastedData = document.getElementById('pasteData').value.trim();
            
            if (!dogName || !pastedData) {
                showError('Please enter both dog name and competition data');
                return;
            }
            
            showProcessing('Processing pasted data...');
            
            try {
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                const parsedData = parseCanuckDogsText(dogName, pastedData);
                
                if (parsedData) {
                    currentDogData = parsedData;
                    calculateAllPoints();
                    displayResults();
                    showSuccess(`Successfully processed data for ${currentDogData.basicInfo.callName}!`);
                } else {
                    showError('Could not parse the competition data. Please check the format.');
                }
                
            } catch (error) {
                showError('Error processing data: ' + error.message);
            } finally {
                hideProcessing();
            }
        }

        function loadDemoData() {
            showProcessing('Loading demo data...');
            
            setTimeout(() => {
                const demoData = {
                    basicInfo: {
                        registeredName: "CAN BIS RBIS GCHB AM CH ROBEL GTO IT'S MILLER TIME AEGEAN H2O",
                        callName: "Miller",
                        owner: "Mamdouh Farag",
                        breed: "Portuguese Water Dog"
                    },
                    yearlyData: {
                        2024: {
                            conformation: [
                                { show: "Calgary Kennel & Obedience Club", dateRange: "May 10-12, 2024", day: "Saturday", position: "Group 1st", judge: "Joan Luna Liebes", dogsBeaten: 32, rawPoints: "64" },
                                { show: "Calgary Kennel & Obedience Club", dateRange: "May 10-12, 2024", day: "Saturday", position: "Best Of Breed", judge: "Joan Luna Liebes", dogsBeaten: 0, rawPoints: "0" },
                                { show: "Hub City Kennel & Obedience Club", dateRange: "May 3-5, 2024", day: "Sunday", position: "Group 3rd", judge: "Darryl Vice", dogsBeaten: 22, rawPoints: "44" },
                                { show: "Hub City Kennel & Obedience Club", dateRange: "May 3-5, 2024", day: "Sunday", position: "Best Of Breed", judge: "Darryl Vice", dogsBeaten: 4, rawPoints: "8(1-2-3-3)" },
                                { show: "Regina Kennel & Obedience Club", dateRange: "May 18-19, 2024", day: "Sunday", position: "Group 3rd", judge: "Tannis Postma", dogsBeaten: 6, rawPoints: "13" },
                                { show: "Regina Kennel & Obedience Club", dateRange: "May 18-19, 2024", day: "Sunday", position: "Best Of Breed", judge: "Tannis Postma", dogsBeaten: 5, rawPoints: "4 (1-1-2-1)" }
                            ]
                        }
                    }
                };
                
                currentDogData = demoData;
                calculateAllPoints();
                displayResults();
                showSuccess(`Demo data loaded for ${currentDogData.basicInfo.callName}! Found ${getTotalShows()} shows with ${currentDogData.totalGrandMasterPoints} total points.`);
                hideProcessing();
            }, 1500);
        }

        function parseCanuckDogsText(dogName, text) {
            // Enhanced parsing logic (simplified for demo)
            const lines = text.split('\n').filter(line => line.trim().length > 0);
            
            const basicInfo = {
                registeredName: dogName,
                callName: extractCallName(dogName),
                owner: extractFromText(lines, 'owner:') || 'Not specified',
                breed: extractFromText(lines, 'breed:') || 'Not specified'
            };
            
            const yearlyData = { 2024: { conformation: [] } };
            
            // Simple parsing for demo - in reality this would be much more sophisticated
            let currentShow = '';
            let currentDate = '';
            
            for (const line of lines) {
                if (line.includes('Club') || line.includes('Association')) {
                    currentShow = line.trim();
                } else if (line.match(/\w+\s+\d+.*\d{4}/)) {
                    currentDate = line.trim();
                } else if (line.includes('Group') || line.includes('Best Of Breed') || line.includes('Winners')) {
                    const result = parseResultLine(line, currentShow, currentDate);
                    if (result) {
                        yearlyData[2024].conformation.push(result);
                    }
                }
            }
            
            return { basicInfo, yearlyData };
        }

        function extractCallName(registeredName) {
            const parts = registeredName.split(' ');
            for (let i = parts.length - 1; i >= 0; i--) {
                const part = parts[i];
                if (part.length > 2 && !part.includes("'S") && !part.match(/^(OF|THE|KENNEL|H2O|GTO)$/i)) {
                    return part;
                }
            }
            return parts[parts.length - 1] || 'Unknown';
        }

        function extractFromText(lines, keyword) {
            for (const line of lines) {
                if (line.toLowerCase().includes(keyword)) {
                    const parts = line.split(':');
                    if (parts.length > 1) return parts[1].trim();
                }
            }
            return null;
        }

        function parseResultLine(line, show, date) {
            const parts = line.trim().split(/\s+/);
            if (parts.length < 3) return null;
            
            let day = 'Unknown';
            let position = 'Unknown';
            let judge = 'Unknown';
            let dogsBeaten = 0;
            let rawPoints = 'N/A';
            
            // Find day of week
            const days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
            for (const d of days) {
                if (line.toLowerCase().includes(d)) {
                    day = d.charAt(0).toUpperCase() + d.slice(1);
                    break;
                }
            }
            
            // Find position
            if (line.toLowerCase().includes('group 1st') || line.toLowerCase().includes('group 1')) {
                position = 'Group 1st';
            } else if (line.toLowerCase().includes('group 2nd') || line.toLowerCase().includes('group 2')) {
                position = 'Group 2nd';
            } else if (line.toLowerCase().includes('group 3rd') || line.toLowerCase().includes('group 3')) {
                position = 'Group 3rd';
            } else if (line.toLowerCase().includes('group 4th') || line.toLowerCase().includes('group 4')) {
                position = 'Group 4th';
            } else if (line.toLowerCase().includes('best of breed')) {
                position = 'Best Of Breed';
            } else if (line.toLowerCase().includes('winners dog')) {
                position = 'Winners Dog';
            } else if (line.toLowerCase().includes('winners bitch')) {
                position = 'Winners Bitch';
            } else if (line.toLowerCase().includes('select')) {
                position = 'Select Dog';
            }
            
            // Extract judge name and points
            const numbers = line.match(/\d+/g);
            if (numbers && numbers.length > 0) {
                dogsBeaten = parseInt(numbers[numbers.length - 1]);
                rawPoints = numbers[numbers.length - 1];
            }
            
            // Extract judge (simplified)
            const judgeMatch = line.match(/([A-Z][a-z]+\s+[A-Z][a-z]+(?:\s+\([^)]+\))?)/);
            if (judgeMatch) {
                judge = judgeMatch[1];
            }
            
            return {
                show: show || 'Unknown Show',
                dateRange: date || 'Unknown Date',
                day: day,
                position: position,
                judge: judge,
                dogsBeaten: dogsBeaten,
                rawPoints: rawPoints
            };
        }

        function calculateAllPoints() {
            let totalPoints = 0;
            
            Object.keys(currentDogData.yearlyData).forEach(year => {
                const yearData = currentDogData.yearlyData[year];
                let yearPoints = 0;
                
                if (yearData.conformation) {
                    yearData.conformation.forEach(result => {
                        const pointsCalc = calculateGrandMasterPoints(result);
                        result.grandMasterPoints = pointsCalc.points;
                        result.calculation = pointsCalc.calculation;
                        yearPoints += pointsCalc.points;
                        totalPoints += pointsCalc.points;
                    });
                }
                
                yearData.totalPoints = yearPoints;
            });
            
            currentDogData.totalGrandMasterPoints = totalPoints;
        }

        function calculateGrandMasterPoints(result) {
            const { position, dogsBeaten } = result;
            let points = 0;
            let steps = [];
            
            const pos = position.toLowerCase();
            const actualDogsBeaten = dogsBeaten || 0;
            
            // Base breed points
            if (pos.includes('best of breed') || pos.includes('winners dog') || pos.includes('winners bitch')) {
                const breedPoints = Math.min(actualDogsBeaten, 5);
                points += breedPoints;
                if (breedPoints > 0) {
                    steps.push(`Breed: min(${actualDogsBeaten}, 5) = ${breedPoints}`);
                }
            }
            
            // Group bonuses
            if (pos.includes('group 1')) {
                const groupPoints = Math.min(actualDogsBeaten * 2, 40);
                points += groupPoints;
                steps.push(`G1: min(${actualDogsBeaten} √ó 2, 40) = ${groupPoints}`);
            } else if (pos.includes('group 2')) {
                const groupPoints = Math.min(Math.floor(actualDogsBeaten * 1.5), 30);
                points += groupPoints;
                steps.push(`G2: min(${actualDogsBeaten} √ó 1.5, 30) = ${groupPoints}`);
            } else if (pos.includes('group 3')) {
                const groupPoints = Math.min(actualDogsBeaten, 20);
                points += groupPoints;
                steps.push(`G3: min(${actualDogsBeaten}, 20) = ${groupPoints}`);
            } else if (pos.includes('group 4')) {
                const groupPoints = Math.min(Math.floor(actualDogsBeaten * 0.5), 10);
                points += groupPoints;
                steps.push(`G4: min(${actualDogsBeaten} √ó 0.5, 10) = ${groupPoints}`);
            }
            
            if (points === 0) {
                if (pos.includes('select')) {
                    steps.push(`${position}: 0 points (no championship points for select)`);
                } else {
                    steps.push(`${position}: 0 points (no dogs defeated)`);
                }
            }
            
            return {
                points: points,
                calculation: steps.length > 0 ? steps.join(' + ') : 'No points earned'
            };
        }

        function displayResults() {
            // Update dog info
            document.getElementById('dogInfo').style.display = 'block';
            document.getElementById('dogTitle').textContent = currentDogData.basicInfo.callName;
            document.getElementById('dogDetails').textContent = 
                `${currentDogData.basicInfo.registeredName} - Owner: ${currentDogData.basicInfo.owner}`;
            
            // Update total points
            document.getElementById('totalPoints').textContent = currentDogData.totalGrandMasterPoints;
            
            // Display recent results
            displayRecentResults();
            displayPointsSummary();
        }

        function displayRecentResults() {
            const allResults = [];
            
            Object.keys(currentDogData.yearlyData).forEach(year => {
                const yearData = currentDogData.yearlyData[year];
                if (yearData.conformation) {
                    yearData.conformation.forEach(result => {
                        allResults.push({...result, year});
                    });
                }
            });
            
            const container = document.getElementById('recentResults');
            container.innerHTML = allResults.slice(0, 6).map(result => `
                <div style="background: ${result.grandMasterPoints > 0 ? '#d4edda' : '#f8f9fa'}; 
                            border-left: 4px solid ${result.grandMasterPoints > 0 ? '#28a745' : '#6c757d'}; 
                            border-radius: 6px; padding: 15px; margin-bottom: 15px;">
                    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px;">
                        <div style="font-weight: bold; color: #2c3e50;">${result.show}</div>
                        <div style="color: #666; font-size: 0.9rem;">${result.dateRange}</div>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px; margin-bottom: 10px;">
                        <div><strong>Day:</strong> ${result.day}</div>
                        <div><strong>Position:</strong> ${result.position}</div>
                        <div><strong>Judge:</strong> ${result.judge}</div>
                        <div><strong>Dogs Beat:</strong> ${result.dogsBeaten}</div>
                    </div>
                    <div style="background: rgba(0,0,0,0.1); padding: 8px; border-radius: 4px;">
                        <strong>GM Points: ${result.grandMasterPoints}</strong>
                        <div style="font-family: monospace; font-size: 0.85rem; margin-top: 4px;">
                            ${result.calculation}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function displayPointsSummary() {
            const totalShows = getTotalShows();
            const pointsEarned = currentDogData.totalGrandMasterPoints;
            
            const container = document.getElementById('pointsSummary');
            container.innerHTML = `
                <div style="display: grid; gap: 15px;">
                    <div style="background: linear-gradient(135deg, #17a2b8, #138496); color: white; padding: 15px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 1.5rem; font-weight: bold;">${totalShows}</div>
                        <div style="opacity: 0.9;">Total Shows</div>
                    </div>
                    <div style="background: linear-gradient(135deg, #28a745, #20c997); color: white; padding: 15px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 1.5rem; font-weight: bold;">${pointsEarned}</div>
                        <div style="opacity: 0.9;">Points Earned</div>
                    </div>
                    <div style="background: linear-gradient(135deg, #6f42c1, #563d7c); color: white; padding: 15px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 1.5rem; font-weight: bold;">${totalShows > 0 ? (pointsEarned / totalShows).toFixed(1) : 0}</div>
                        <div style="opacity: 0.9;">Avg per Show</div>
                    </div>
                </div>
                
                <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                    <h4 style="margin-bottom: 10px; color: #2c3e50;">Title Progress:</h4>
                    ${generateTitleProgress()}
                </div>
            `;
        }

        function generateTitleProgress() {
            const points = currentDogData.totalGrandMasterPoints;
            const titles = [
                { name: 'Grand Champion (GCH)', threshold: 20 },
                { name: 'Grand Champion Excellent (GCHX)', threshold: 100 },
                { name: 'Grand Master (GM)', threshold: 200 },
                { name: 'Grand Master Supreme (GMS)', threshold: 400 }
            ];
            
            return titles.map(title => {
                const achieved = points >= title.threshold;
                const needed = Math.max(0, title.threshold - points);
                
                return `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid #dee2e6;">
                        <span>${title.name}</span>
                        <span style="padding: 4px 8px; border-radius: 4px; font-size: 0.85rem; font-weight: bold; 
                                     background: ${achieved ? '#d4edda' : '#fff3cd'}; 
                                     color: ${achieved ? '#155724' : '#856404'};">
                            ${achieved ? '‚úÖ Achieved' : `${needed} pts needed`}
                        </span>
                    </div>
                `;
            }).join('');
        }

        function getTotalShows() {
            let total = 0;
            Object.values(currentDogData.yearlyData).forEach(yearData => {
                if (yearData.conformation) {
                    total += yearData.conformation.length;
                }
            });
            return total;
        }

        // Utility functions
        function showProcessing(message) {
            document.getElementById('statusText').textContent = message;
            document.getElementById('processingStatus').style.display = 'block';
            hideMessages();
        }

        function hideProcessing() {
            document.getElementById('processingStatus').style.display = 'none';
        }

        function showSuccess(message) {
            document.getElementById('successMessage').textContent = message;
            document.getElementById('successMessage').style.display = 'block';
            hideProcessing();
        }

        function showError(message) {
            document.getElementById('errorMessage').textContent = message;
            document.getElementById('errorMessage').style.display = 'block';
            hideProcessing();
        }

        function hideMessages() {
            document.getElementById('successMessage').style.display = 'none';
            document.getElementById('errorMessage').style.display = 'none';
        }

        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(tabName).classList.add('active');
            document.querySelector(`[onclick="showTab('${tabName}')"]`).classList.add('active');
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Set up initial state
            selectMethod('pdf');
            
            // Add keyboard shortcuts
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    hideMessages();
                }
            });
        });

        // Real PDF Processing with PDF.js Integration
        async function processPDFWithLibrary(file) {
            try {
                showProcessing('Reading PDF file...');
                
                const arrayBuffer = await file.arrayBuffer();
                const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
                
                let fullText = '';
                const totalPages = pdf.numPages;
                
                // Skip first 3 pages as specified in workflow
                const startPage = Math.min(4, totalPages);
                
                showProcessing(`Extracting text from pages ${startPage}-${totalPages}...`);
                
                for (let pageNum = startPage; pageNum <= totalPages; pageNum++) {
                    try {
                        const page = await pdf.getPage(pageNum);
                        const textContent = await page.getTextContent();
                        
                        // Extract text items and preserve spacing
                        const pageText = textContent.items.map(item => {
                            if (item.str && item.str.trim()) {
                                return item.str;
                            }
                            return '';
                        }).join(' ');
                        
                        fullText += pageText + '\n';
                        
                        // Update progress
                        showProcessing(`Processing page ${pageNum} of ${totalPages}...`);
                        
                        // Small delay to prevent UI blocking
                        await new Promise(resolve => setTimeout(resolve, 50));
                        
                    } catch (pageError) {
                        console.warn(`Error processing page ${pageNum}:`, pageError);
                        // Continue with other pages
                    }
                }
                
                if (!fullText.trim()) {
                    throw new Error('No text could be extracted from the PDF');
                }
                
                return fullText;
                
            } catch (error) {
                throw new Error('Failed to process PDF: ' + error.message);
            }
        }

        async function processFile(file) {
            const dogName = document.getElementById('dogName').value.trim();
            if (!dogName) {
                showError('Please enter the dog\'s registered name first');
                return;
            }

            showProcessing('Processing PDF and extracting competition data...');
            
            try {
                // Show PDF preview
                showPDFPreview(file);
                
                // Extract text using PDF.js
                const extractedText = await processPDFWithLibrary(file);
                
                if (!extractedText || extractedText.trim().length < 100) {
                    throw new Error('Insufficient text extracted from PDF. Please check the file.');
                }
                
                // Update preview with extracted text
                document.getElementById('extractedTextPreview').textContent = extractedText;
                
                showProcessing('Parsing competition data...');
                
                // Parse the extracted text
                const parsedData = parseCanuckDogsText(dogName, extractedText);
                
                if (parsedData && Object.keys(parsedData.yearlyData).length > 0) {
                    currentDogData = parsedData;
                    calculateAllPoints();
                    displayResults();
                    
                    const totalShows = getTotalShows();
                    const totalPoints = currentDogData.totalGrandMasterPoints;
                    
                    showSuccess(`‚úÖ Successfully processed PDF for ${currentDogData.basicInfo.callName}! Found ${totalShows} shows with ${totalPoints} total Grand Master points.`);
                } else {
                    showError('Could not parse competition data from PDF. The file may not contain CanuckDogs competition results, or the format may not be recognized.');
                }
                
            } catch (error) {
                console.error('PDF processing error:', error);
                showError('Error processing PDF: ' + error.message + '. Please ensure this is a CanuckDogs competition results PDF.');
            } finally {
                hideProcessing();
            }
        }

                        <!-- Auto-Fetch Method -->
                <div id="auto-method" class="method-content" style="display: none;">
                    <div class="input-group">
                        <label>Dog's Registered Name:</label>
                        <input type="text" id="dogNameAuto" class="input-field" placeholder="Enter the registered name..." />
                    </div>

                    <div style="background: rgba(255, 255, 255, 0.1); border-radius: 8px; padding: 20px; margin-bottom: 20px;">
                        <h4 style="margin-bottom: 15px;">ü§ñ Automation Status</h4>
                        <div id="automationStatus" style="padding: 15px; background: rgba(255, 255, 255, 0.1); border-radius: 6px; margin-bottom: 15px;">
                            <strong>‚ùå Browser Extension Required</strong><br>
                            <span style="opacity: 0.9;">Direct automation is not possible due to browser security restrictions (CORS policy).</span>
                        </div>
                        
                        <button onclick="showAutomationOptions()" class="btn-primary" style="background: linear-gradient(45deg, #17a2b8, #138496);">
                            üîß View Automation Solutions
                        </button>
                    </div>

                    <div class="workflow-steps">
                        <h4>üö´ Why Direct Automation Isn't Possible:</h4>
                        <ul style="margin: 10px 0; padding-left: 20px; line-height: 1.6;">
                            <li><strong>CORS Policy:</strong> Browsers block cross-origin requests to other websites</li>
                            <li><strong>Same-Origin Policy:</strong> Can't control or read content from CanuckDogs.ca</li>
                            <li><strong>Security Restrictions:</strong> Prevents malicious websites from accessing other sites</li>
                            <li><strong>File System Access:</strong> Web pages can't save files to arbitrary locations</li>
                        </ul>
                    </div>
                </div>

        function showAutomationOptions() {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                z-index: 10000;
                display: flex;
                align-items: center;
                justify-content: center;
                padding: 20px;
            `;
            
            modal.innerHTML = `
                <div style="background: white; border-radius: 15px; padding: 30px; max-width: 800px; max-height: 80vh; overflow-y: auto;">
                    <h2 style="margin-bottom: 20px; color: #2c3e50;">ü§ñ Automation Solutions for CanuckDogs</h2>
                    
                    <div style="background: #f8d7da; border: 1px solid #f5c6cb; border-radius: 8px; padding: 15px; margin: 20px 0; color: #721c24;">
                        <h3 style="margin-bottom: 10px;">‚ö†Ô∏è Direct Automation Not Possible</h3>
                        <p>Due to browser security (CORS policy), websites cannot automatically navigate to other domains, fill forms, or download files from external sites like CanuckDogs.ca.</p>
                    </div>
                    
                    <h3 style="margin: 20px 0 10px 0; color: #495057;">‚úÖ Available Solutions:</h3>
                    
                    <div style="display: grid; gap: 20px;">
                        <div style="border: 2px solid #28a745; border-radius: 8px; padding: 20px; background: #d4edda;">
                            <h4 style="color: #155724; margin-bottom: 10px;">üîß Browser Extension (Recommended)</h4>
                            <p style="color: #155724; margin-bottom: 15px;">A Chrome/Firefox extension that runs in the CanuckDogs context and can automate your workflow.</p>
                            <div style="background: rgba(255,255,255,0.7); padding: 10px; border-radius: 4px; margin: 10px 0;">
                                <strong>How it works:</strong><br>
                                1. Install extension<br>
                                2. Go to CanuckDogs.ca<br>
                                3. Extension adds "Send to CKC Tracker" button<br>
                                4. Automatically follows your PDF workflow<br>
                                5. Sends data directly to this tool
                            </div>
                        </div>
                        
                        <div style="border: 2px solid #17a2b8; border-radius: 8px; padding: 20px; background: #d1ecf1;">
                            <h4 style="color: #0c5460; margin-bottom: 10px;">üì± Desktop Application</h4>
                            <p style="color: #0c5460; margin-bottom: 15px;">A standalone desktop app that can automate web browsing without browser restrictions.</p>
                            <div style="background: rgba(255,255,255,0.7); padding: 10px; border-radius: 4px;">
                                <strong>Technologies:</strong> Electron + Puppeteer, Python + Selenium, or similar
                            </div>
                        </div>
                        
                        <div style="border: 2px solid #ffc107; border-radius: 8px; padding: 20px; background: #fff3cd;">
                            <h4 style="color: #856404; margin-bottom: 10px;">üîñ Enhanced Bookmarklet</h4>
                            <p style="color: #856404; margin-bottom: 15px;">JavaScript bookmarklet that runs on CanuckDogs pages to extract and send data.</p>
                            <div style="background: rgba(255,255,255,0.7); padding: 10px; border-radius: 4px;">
                                <strong>Limitation:</strong> Still requires manual navigation to print page
                            </div>
                        </div>
                        
                        <div style="border: 2px solid #6f42c1; border-radius: 8px; padding: 20px; background: #e2d9f3;">
                            <h4 style="color: #493057; margin-bottom: 10px;">üåê Proxy/Server Solution</h4>
                            <p style="color: #493057; margin-bottom: 15px;">Backend server that handles CanuckDogs automation and serves data to the website.</p>
                            <div style="background: rgba(255,255,255,0.7); padding: 10px; border-radius: 4px;">
                                <strong>Note:</strong> More complex, requires server infrastructure
                            </div>
                        </div>
                    </div>
                    
                    <div style="background: #e7f3ff; border: 1px solid #b3d9ff; border-radius: 8px; padding: 15px; margin: 20px 0;">
                        <h4 style="color: #0056b3; margin-bottom: 10px;">üí° Recommended Approach</h4>
                        <p style="color: #0056b3; margin-bottom: 10px;">For now, continue with the <strong>manual PDF workflow</strong> - it's reliable and gives you complete control:</p>
                        <ol style="color: #0056b3; padding-left: 20px;">
                            <li>Follow the CanuckDogs PDF generation steps</li>
                            <li>Upload the PDF to this tool</li>
                            <li>Get automatic points calculation</li>
                        </ol>
                        <p style="color: #0056b3; margin-top: 10px;"><strong>Future:</strong> A browser extension could be developed to automate steps 1-2.</p>
                    </div>
                    
                    <div style="text-align: center; margin-top: 20px;">
                        <button onclick="this.parentElement.parentElement.parentElement.remove()" 
                                style="background: #6c757d; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-size: 1rem;">
                            Close
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
    </script>
</body>
</html>
