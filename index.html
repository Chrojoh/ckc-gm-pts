<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CKC Grand Master Points Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .search-section {
            padding: 30px;
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
        }

        .search-box {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .search-input {
            padding: 15px 20px;
            font-size: 1.1rem;
            border: none;
            border-radius: 8px;
            min-width: 400px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .search-btn {
            padding: 15px 30px;
            font-size: 1.1rem;
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .search-btn:hover {
            transform: translateY(-2px);
        }

        .tabs {
            display: flex;
            background: #34495e;
            border-bottom: 3px solid #2c3e50;
        }

        .tab {
            flex: 1;
            padding: 15px 20px;
            background: #34495e;
            color: white;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s;
            border-right: 1px solid #2c3e50;
        }

        .tab:last-child {
            border-right: none;
        }

        .tab:hover {
            background: #3498db;
        }

        .tab.active {
            background: #2c3e50;
            box-shadow: inset 0 3px 0 #e74c3c;
        }

        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        .status {
            display: none;
            padding: 30px;
            text-align: center;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 350px 1fr 350px;
            gap: 30px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            border: 1px solid #e0e6ed;
        }

        .card h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.5rem;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }

        .points-display {
            background: linear-gradient(135deg, #27ae60, #229954);
            color: white;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 20px;
        }

        .points-display h3 {
            font-size: 1.4rem;
            margin-bottom: 10px;
        }

        .points-display .points-number {
            font-size: 3.5rem;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .title-progress {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .title-level {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }

        .title-level:last-child {
            border-bottom: none;
        }

        .title-achieved {
            background: rgba(255,255,255,0.2);
            border-radius: 6px;
            padding: 4px 8px;
        }

        .title-current {
            background: #e74c3c;
            border-radius: 6px;
            padding: 4px 8px;
            font-weight: bold;
        }

        .yearly-breakdown {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .year-card {
            background: linear-gradient(135deg, #34495e, #2c3e50);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .year-card:hover {
            transform: translateY(-3px);
        }

        .year-card.selected {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            box-shadow: 0 8px 20px rgba(231,76,60,0.3);
        }

        .year-card h3 {
            font-size: 1.5rem;
            margin-bottom: 10px;
        }

        .year-card .year-points {
            font-size: 2rem;
            font-weight: bold;
        }

        .show-results {
            display: grid;
            gap: 15px;
        }

        .show-result {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 10px;
            padding: 20px;
            position: relative;
            transition: all 0.3s;
        }

        .show-result:hover {
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .show-result.points-earned {
            border-left: 5px solid #27ae60;
            background: linear-gradient(135deg, #d4edda, #c3e6cb);
        }

        .show-result.no-points {
            border-left: 5px solid #6c757d;
        }

        .show-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .show-name {
            font-size: 1.1rem;
            font-weight: bold;
            color: #2c3e50;
            flex: 1;
        }

        .show-date {
            color: #666;
            font-size: 0.9rem;
            margin-left: 15px;
        }

        .show-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
            font-size: 0.9rem;
        }

        .detail-item {
            background: white;
            padding: 8px 12px;
            border-radius: 6px;
            border: 1px solid #e9ecef;
        }

        .detail-label {
            font-weight: bold;
            color: #495057;
            display: block;
            font-size: 0.8rem;
            margin-bottom: 2px;
        }

        .points-calculation {
            background: linear-gradient(135deg, #17a2b8, #138496);
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .calculation-formula {
            font-family: 'Courier New', monospace;
            background: rgba(255,255,255,0.1);
            padding: 8px;
            border-radius: 4px;
            margin-top: 8px;
            font-size: 0.9rem;
        }

        .canuckdogs-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .canuckdogs-table th {
            background: #2c3e50;
            color: white;
            padding: 12px 8px;
            text-align: left;
            font-size: 0.9rem;
        }

        .canuckdogs-table td {
            padding: 10px 8px;
            border-bottom: 1px solid #ecf0f1;
            font-size: 0.85rem;
        }

        .canuckdogs-table tr:hover {
            background: #f8f9fa;
        }

        .export-section {
            background: linear-gradient(135deg, #fd7e14, #e9630a);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            margin-top: 30px;
        }

        .export-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid white;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            margin: 0 10px;
            transition: all 0.3s;
        }

        .export-btn:hover {
            background: white;
            color: #fd7e14;
        }

        .error {
            display: none;
            background: #e74c3c;
            color: white;
            padding: 20px;
            text-align: center;
        }

        .dog-info {
            background: linear-gradient(135deg, #6f42c1, #563d7c);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .dog-info h3 {
            margin-bottom: 5px;
            font-size: 1.3rem;
        }

        .dog-info p {
            opacity: 0.9;
        }

        .search-result-item {
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            margin-bottom: 15px;
        }

        .search-result-item:hover {
            border-color: #3498db;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52,152,219,0.3);
        }

        .search-result-item.exact-match {
            border-color: #28a745;
            background: linear-gradient(135deg, #d4edda, #c3e6cb);
        }

        .match-badge {
            background: #28a745;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-bottom: 10px;
            display: inline-block;
        }

        .partial-match-badge {
            background: #17a2b8;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-bottom: 10px;
            display: inline-block;
        }

        @media (max-width: 1200px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
        }

        .win-highlight {
            background: linear-gradient(135deg, #d4edda, #c3e6cb) !important;
        }

        .placement-highlight {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7) !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üèÜ CKC Grand Master Points Tracker</h1>
            <p>Search CanuckDogs & Calculate Championship Points Automatically</p>
        </div>

        <div class="search-section">
            <h2>Import Your Dog's CanuckDogs Data</h2>
            <p style="margin-bottom: 15px; opacity: 0.9; font-size: 1rem;">
                üìã Choose how to import your dog's competition data
            </p>
            
            <!-- Tab Selection -->
            <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                <button onclick="showImportMethod('search')" id="searchTabBtn" class="search-btn" style="padding: 10px 20px; font-size: 0.9rem;">
                    üîç Search CanuckDogs
                </button>
                <button onclick="showImportMethod('paste')" id="pasteTabBtn" class="search-btn" style="padding: 10px 20px; font-size: 0.9rem; background: #6c757d;">
                    üìã Paste Data
                </button>
                <button onclick="showImportMethod('bookmarklet')" id="bookmarkletTabBtn" class="search-btn" style="padding: 10px 20px; font-size: 0.9rem; background: #6c757d;">
                    üîñ Auto-Extract
                </button>
            </div>
            
            <!-- Search Method -->
            <div id="searchMethod" class="import-method">
                <div class="search-box">
                    <input type="text" id="dogName" class="search-input" placeholder="e.g., ROBEL MILLER TIME, SUNNYDALE GOLDEN..." />
                    <button onclick="searchCanuckDogs()" id="searchBtn" class="search-btn">üîç Search CanuckDogs</button>
                </div>
                <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; margin-top: 15px;">
                    <h4 style="margin-bottom: 10px;">üí° Search Tips:</h4>
                    <ul style="margin: 0; padding-left: 20px; line-height: 1.6;">
                        <li><strong>Spelling is important</strong> - match the exact spelling from registration</li>
                        <li><strong>Put in as much as you can</strong> of the registered name</li>
                        <li><strong>Do not include titles</strong> - no "CH", "GCH", "AM CH" prefixes</li>
                        <li><strong>Use only the registered name</strong> - no prefixes or suffixes</li>
                    </ul>
                </div>
            </div>
            
            <!-- Paste Method -->
            <div id="pasteMethod" class="import-method" style="display: none;">
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">Dog's Registered Name:</label>
                    <input type="text" id="manualDogName" class="search-input" placeholder="Enter the registered name..." style="width: 100%; margin-bottom: 10px;" />
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">CanuckDogs Competition Data:</label>
                    <textarea id="canuckDogsData" class="search-input" placeholder="Copy and paste the competition results from the dog's CanuckDogs page..." 
                             style="width: 100%; height: 200px; font-family: monospace; font-size: 0.9rem; resize: vertical;"></textarea>
                </div>
                <button onclick="processManualData()" class="search-btn">üìä Calculate Points</button>
                
                <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; margin-top: 15px;">
                    <h4 style="margin-bottom: 10px;">üìã How to Copy Data from CanuckDogs:</h4>
                    <ol style="margin: 0; padding-left: 20px; line-height: 1.6;">
                        <li>Go to your dog's CanuckDogs page</li>
                        <li>Select and copy all the competition results text</li>
                        <li>Paste it into the text area above</li>
                        <li>Click "Calculate Points" to process the data</li>
                    </ol>
                </div>
            </div>
            
            <!-- Bookmarklet Method -->
            <div id="bookmarkletMethod" class="import-method" style="display: none;">
                <div style="background: linear-gradient(135deg, #17a2b8, #138496); color: white; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                    <h3 style="margin-bottom: 15px;">üîñ Auto-Extract Bookmarklet</h3>
                    <p style="margin-bottom: 15px;">Create a bookmark that automatically extracts data from any CanuckDogs page:</p>
                    <button onclick="showBookmarkletCode()" class="export-btn" style="margin: 0;">
                        üìã Get Bookmarklet Code
                    </button>
                </div>
                
                <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px;">
                    <h4 style="margin-bottom: 10px;">üöÄ How It Works:</h4>
                    <ol style="margin: 0; padding-left: 20px; line-height: 1.6;">
                        <li><strong>One-time setup:</strong> Add the bookmarklet to your browser</li>
                        <li><strong>Go to any CanuckDogs page</strong> for your dog</li>
                        <li><strong>Click the bookmarklet</strong> - data transfers automatically</li>
                        <li><strong>Points calculated instantly</strong> in this tool</li>
                    </ol>
                </div>
            </div>
        </div>

        <div id="status" class="status">
            <div class="spinner"></div>
            <p id="statusText">Searching CanuckDogs database...</p>
        </div>

        <div id="error" class="error">
            <p id="errorMessage"></p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('dashboard')">üìä Points Dashboard</button>
            <button class="tab" onclick="showTab('yearly')">üìÖ Year-by-Year Progress</button>
            <button class="tab" onclick="showTab('rawdata')">üìã CanuckDogs Raw Data</button>
            <button class="tab" onclick="showTab('reports')">üìÑ Export Reports</button>
        </div>

        <div id="dashboard" class="tab-content active">
            <div class="dashboard-grid">
                <div class="card">
                    <div id="dogInfo" class="dog-info" style="display: none;">
                        <h3 id="dogTitle">Dog Name</h3>
                        <p id="dogDetails">Search for a dog to view championship points</p>
                    </div>

                    <div class="points-display">
                        <h3>Total Grand Master Points</h3>
                        <div class="points-number" id="totalPoints">0</div>
                        <small>Lifetime Total</small>
                    </div>

                    <div class="title-progress">
                        <h3>üéñÔ∏è Title Progress</h3>
                        <div class="title-level">
                            <span>Champion (CH)</span>
                            <span id="chStatus" class="title-achieved">‚úì</span>
                        </div>
                        <div class="title-level">
                            <span>Grand Champion (GCH)</span>
                            <span id="gchStatus">20 pts needed</span>
                        </div>
                        <div class="title-level">
                            <span>Grand Champion Excellent (GCHX)</span>
                            <span id="gchxStatus">100 pts needed</span>
                        </div>
                        <div class="title-level">
                            <span>Grand Master (GM)</span>
                            <span id="gmStatus">200 pts needed</span>
                        </div>
                        <div class="title-level">
                            <span>Grand Master Supreme (GMS)</span>
                            <span id="gmsStatus">400 pts needed</span>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h2>üèÜ Recent Show Results</h2>
                    <div id="recentResults">
                        <p style="text-align: center; color: #666; padding: 40px;">
                            Search for a dog to see championship point calculations
                        </p>
                    </div>
                </div>

                <div class="card">
                    <h2>üìà Points Summary</h2>
                    <div id="pointsSummary">
                        <div style="text-align: center; color: #666; padding: 40px;">
                            <p>Points breakdown will appear here after selecting a dog</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="yearly" class="tab-content">
            <div class="yearly-breakdown" id="yearlyBreakdown">
                <p style="text-align: center; color: #666; padding: 40px;">
                    Select a dog to see year-by-year progression
                </p>
            </div>
            <div id="selectedYearDetails"></div>
        </div>

        <div id="rawdata" class="tab-content">
            <h2>üìã Raw CanuckDogs Competition Data</h2>
            <div id="rawDataTable">
                <p style="text-align: center; color: #666; padding: 40px;">
                    Selected dog's competition data will appear here
                </p>
            </div>
        </div>

        <div id="reports" class="tab-content">
            <div class="export-section">
                <h2>üìä Generate Championship Points Reports</h2>
                <p style="margin: 20px 0;">Generate comprehensive PDF reports with points calculations and supporting data</p>
                
                <button class="export-btn" onclick="generatePDFReport('complete')">
                    üìÑ Complete Championship Report
                </button>
                <button class="export-btn" onclick="generatePDFReport('yearly')">
                    üìÖ Year-by-Year Progress Report
                </button>
                <button class="export-btn" onclick="generatePDFReport('verification')">
                    ‚úÖ Points Verification Report
                </button>
                
                <div style="margin-top: 30px; background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px;">
                    <h3>Report Contents:</h3>
                    <ul style="text-align: left; margin: 10px 0; padding-left: 40px;">
                        <li>Official CKC Grand Master points calculation formulas</li>
                        <li>Complete show-by-show point breakdown</li>
                        <li>Title progression timeline</li>
                        <li>Raw CanuckDogs extracted data</li>
                        <li>Points verification with supporting calculations</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentDogData = null;
        let selectedYear = null;
        let searchResults = [];

        // Import method switching
        function showImportMethod(method) {
            // Hide all methods
            document.querySelectorAll('.import-method').forEach(div => {
                div.style.display = 'none';
            });
            
            // Reset button styles
            document.querySelectorAll('[id$="TabBtn"]').forEach(btn => {
                btn.style.background = '#6c757d';
            });
            
            // Show selected method and highlight button
            document.getElementById(method + 'Method').style.display = 'block';
            document.getElementById(method + 'TabBtn').style.background = 'linear-gradient(45deg, #e74c3c, #c0392b)';
        }

        // Manual data processing
        async function processManualData() {
            const dogName = document.getElementById('manualDogName').value.trim();
            const rawData = document.getElementById('canuckDogsData').value.trim();
            
            if (!dogName || !rawData) {
                alert('Please enter both the dog name and competition data');
                return;
            }
            
            showLoading('Processing CanuckDogs data...');
            hideError();
            
            try {
                // Simulate processing time
                await new Promise(resolve => setTimeout(resolve, 1500));
                
                // Parse the manual data
                const parsedData = parseCanuckDogsText(dogName, rawData);
                
                if (parsedData) {
                    currentDogData = parsedData;
                    calculateAllPoints();
                    displayDashboard();
                    displayYearlyBreakdown();
                    displayRawData();
                    showSuccessMessage(`Successfully processed data for ${currentDogData.basicInfo.callName}!`);
                } else {
                    showError('Could not parse the CanuckDogs data. Please check the format and try again.');
                }
                
            } catch (error) {
                showError('Error processing data: ' + error.message);
            } finally {
                hideLoading();
            }
        }

        // Parse text data from CanuckDogs
        function parseCanuckDogsText(dogName, rawText) {
            try {
                const lines = rawText.split('\n').map(line => line.trim()).filter(line => line.length > 0);
                
                // Extract basic info
                const basicInfo = {
                    registeredName: dogName,
                    callName: extractCallName(dogName),
                    owner: 'Unknown Owner',
                    breed: 'Unknown Breed'
                };
                
                // Look for owner and breed info in the text
                lines.forEach(line => {
                    if (line.toLowerCase().includes('owner:') || line.toLowerCase().includes('owned by')) {
                        basicInfo.owner = line.split(':')[1]?.trim() || basicInfo.owner;
                    }
                    if (line.toLowerCase().includes('breed:')) {
                        basicInfo.breed = line.split(':')[1]?.trim() || basicInfo.breed;
                    }
                });
                
                // Parse competition results
                const yearlyData = {};
                let currentYear = new Date().getFullYear();
                let currentShow = '';
                let currentDateRange = '';
                
                const results = [];
                
                lines.forEach(line => {
                    // Look for year indicators
                    const yearMatch = line.match(/20\d{2}/);
                    if (yearMatch) {
                        currentYear = parseInt(yearMatch[0]);
                    }
                    
                    // Look for show names (lines with "Club", "Association", "Kennel", etc.)
                    if (line.match(/\b(club|association|kennel|society|show)\b/i) && !line.match(/\b(judge|points|group|breed)\b/i)) {
                        currentShow = line;
                        return;
                    }
                    
                    // Look for date ranges
                    if (line.match(/\b(january|february|march|april|may|june|july|august|september|october|november|december)\b/i)) {
                        currentDateRange = line;
                        return;
                    }
                    
                    // Look for competition results
                    const resultMatch = line.match(/(monday|tuesday|wednesday|thursday|friday|saturday|sunday).*?(best of breed|bob|winners dog|winners bitch|wd|wb|group \d+|group \d+st|group \d+nd|group \d+rd|group \d+th|select|best of opposite)/i);
                    
                    if (resultMatch && currentShow) {
                        const day = resultMatch[1];
                        const position = resultMatch[2];
                        
                        // Extract judge and points
                        const parts = line.split(/\s+/);
                        let judge = 'Unknown Judge';
                        let rawPoints = 'N/A';
                        let dogsBeaten = 0;
                        
                        // Look for judge name (usually between position and points)
                        const positionIndex = parts.findIndex(part => 
                            part.toLowerCase().includes(position.toLowerCase().split(' ')[0])
                        );
                        
                        if (positionIndex >= 0 && positionIndex < parts.length - 2) {
                            // Judge is likely the next 1-2 words
                            judge = parts.slice(positionIndex + 1, positionIndex + 3).join(' ');
                        }
                        
                        // Extract points (usually last number or number in parentheses)
                        const pointsMatch = line.match(/(\d+)\s*(\([^)]+\))?$/);
                        if (pointsMatch) {
                            rawPoints = pointsMatch[0];
                            dogsBeaten = parseInt(pointsMatch[1]);
                        }
                        
                        results.push({
                            show: currentShow,
                            dateRange: currentDateRange || `${currentYear}`,
                            day: day,
                            position: position,
                            judge: judge.replace(/\d+.*/, '').trim() || 'Unknown Judge',
                            rawPoints: rawPoints,
            function extractCallName(registeredName) {
            // Try to extract call name from registered name
            const parts = registeredName.split(' ');
            // Usually the call name is one of the last parts
            for (let i = parts.length - 1; i >= 0; i--) {
                const part = parts[i];
                if (part.length > 2 && !part.includes("'S") && !part.match(/^(OF|THE|KENNEL)$/i)) {
                    return part;
                }
            }
            return parts[parts.length - 1] || 'Unknown';
        }

        function extractYearFromDate(dateString) {
            const match = dateString.match(/\b(202[0-5])\b/);
            return match ? parseInt(match[1]) : null;
        }

        // Remove the complex scraping functions that don't work reliably
        // Focus on the methods that actually work

        function showBookmarkletCode() {
            const bookmarkletCode = `javascript:(function(){
                try {
                    const pageText = document.body.innerText;
                    const pageTitle = document.title;
                    
                    // Try to extract dog name from page title or content
                    let dogName = pageTitle.split(' - ')[0] || 'Unknown Dog';
                    
                    // Open calculator window and send data
                    const calculatorWindow = window.open('', 'CKCTracker');
                    
                    setTimeout(() => {
                        if (calculatorWindow && !calculatorWindow.closed) {
                            calculatorWindow.postMessage({
                                type: 'canuckDogsData',
                                dogName: dogName,
                                rawData: pageText
                            }, '*');
                            calculatorWindow.focus();
                        } else {
                            alert('Calculator window blocked. Please allow popups and try again.');
                        }
                    }, 2000);
                    
                } catch (error) {
                    alert('Error extracting data: ' + error.message);
                }
            })();`;
            
            // Show the bookmarklet code in a modal
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                z-index: 10000;
                display: flex;
                align-items: center;
                justify-content: center;
                padding: 20px;
            `;
            
            modal.innerHTML = `
                <div style="background: white; border-radius: 15px; padding: 30px; max-width: 800px; max-height: 80vh; overflow-y: auto;">
                    <h2 style="margin-bottom: 20px; color: #2c3e50;">üîñ CanuckDogs Auto-Extractor Bookmarklet</h2>
                    
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 20px 0;">
                        <h3 style="margin-bottom: 10px; color: #495057;">üìã Setup Steps:</h3>
                        <ol style="padding-left: 20px; line-height: 1.6;">
                            <li>Copy ALL the code below</li>
                            <li>Right-click your bookmarks bar ‚Üí "Add page"</li>
                            <li>Name: "Extract CanuckDogs"</li>
                            <li>URL: Paste the copied code</li>
                            <li>Save the bookmark</li>
                        </ol>
                    </div>
                    
                    <h3 style="margin: 20px 0 10px 0; color: #495057;">üìù Bookmarklet Code:</h3>
                    <textarea readonly style="width: 100%; height: 200px; font-family: monospace; font-size: 12px; padding: 10px; border: 1px solid #ccc; border-radius: 4px; background: #f8f9fa;">${bookmarkletCode}</textarea>
                    
                    <div style="text-align: center; margin-top: 20px;">
                        <button onclick="this.parentElement.parentElement.parentElement.remove()" style="background: #dc3545; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-size: 1rem;">
                            Close
                        </button>
                        <button onclick="navigator.clipboard.writeText('${bookmarkletCode.replace(/'/g, "\\'")}').then(() => alert('Bookmarklet copied!'))" style="background: #28a745; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-size: 1rem; margin-left: 10px;">
                            üìã Copy Code
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        // Listen for bookmarklet messages
        window.addEventListener('message', function(event) {
            if (event.data.type === 'canuckDogsData') {
                // Switch to paste method and populate data
                showImportMethod('paste');
                document.getElementById('manualDogName').value = event.data.dogName;
                document.getElementById('canuckDogsData').value = event.data.rawData;
                showSuccessMessage('Data received from bookmarklet! Click "Calculate Points" to process.');
            }
        });

        // Update selectDogFromSearch to handle the simplified approach
        async function selectDogFromSearch(dogId) {
            const selectedDog = searchResults.find(r => r.id === dogId);
            
            if (!selectedDog) {
                showError('Selected dog not found');
                return;
            }
            
            showLoading(`Loading data for ${selectedDog.callName}...`);
            
            try {
                if (selectedDog.isDemo && selectedDog.id === 'demo_miller') {
                    // Load demo data for Miller
                    currentDogData = mockCanuckDogsData;
                    calculateAllPoints();
                    displayDashboard();
                    displayYearlyBreakdown();
                    displayRawData();
                    showSuccessMessage(`Successfully loaded demo data for ${currentDogData.basicInfo.callName}!`);
                } else {
                    // For non-demo results, guide user to paste method
                    showError(`Please use the "Paste Data" method to import data for ${selectedDog.name}. The automated search requires manual navigation on CanuckDogs.`);
                }
                
            } catch (error) {
                showError(`Error loading data: ${error.message}`);
            } finally {
                hideLoading();
            }
        }Beaten
                        });
                    }
                });
                
                // Group results by year
                results.forEach(result => {
                    const year = extractYearFromDate(result.dateRange) || currentYear;
                    if (!yearlyData[year]) {
                        yearlyData[year] = { conformation: [] };
                    }
                    yearlyData[year].conformation.push(result);
                });
                
                // If no results found, create sample data to show the system works
                if (results.length === 0) {
                    yearlyData[currentYear] = {
                        conformation: [{
                            show: 'Sample Show (Parsed from manual data)',
                            dateRange: `Sample Date ${currentYear}`,
                            day: 'Saturday',
                            position: 'Best Of Breed',
                            judge: 'Sample Judge',
                            rawPoints: '0',
                            dogsBeaten: 0
                        }]
                    };
                }
                
                return { basicInfo, yearlyData };
                
            } catch (error) {
                console.error('Error parsing CanuckDogs text:', error);
                return null;
            }
        }

        function extractCallName(registeredName) {
            // Try to extract call name from registered name
            const parts = registeredName.split(' ');
            // Usually the call name is one of the last parts
            for (let i = parts.length - 1; i >= 0; i--) {
                const part = parts[i];
                if (part.length > 2 && !part.includes("'S") && !part.match(/^(OF|THE|KENNEL)$/i)) {
                    return part;
                }
            }
            return parts[parts.length - 1] || 'Unknown';
        }

        function extractYearFromDate(dateString) {
            const match = dateString.match(/20\d{2}/);
            return match ? parseInt(match[0]) : null;
        }

        function showBookmarkletCode() {
            const bookmarkletCode = `javascript:(function(){
                try {
                    const pageText = document.body.innerText;
                    const pageTitle = document.title;
                    
                    // Try to extract dog name from page title or content
                    let dogName = pageTitle.split(' - ')[0] || 'Unknown Dog';
                    
                    // Open calculator window and send data
                    const calculatorWindow = window.open(window.location.origin + window.location.pathname.replace(/[^/]+$/, '') + 'index.html', 'CKCTracker');
                    
                    setTimeout(() => {
                        if (calculatorWindow && !calculatorWindow.closed) {
                            calculatorWindow.postMessage({
                                type: 'canuckDogsData',
                                dogName: dogName,
                                rawData: pageText
                            }, '*');
                            calculatorWindow.focus();
                        } else {
                            alert('Calculator window blocked. Please allow popups and try again.');
                        }
                    }, 2000);
                    
                } catch (error) {
                    alert('Error extracting data: ' + error.message);
                }
            })();`;
            
            // Show the bookmarklet code in a modal
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                z-index: 10000;
                display: flex;
                align-items: center;
                justify-content: center;
                padding: 20px;
            `;
            
            modal.innerHTML = `
                <div style="background: white; border-radius: 15px; padding: 30px; max-width: 800px; max-height: 80vh; overflow-y: auto;">
                    <h2 style="margin-bottom: 20px; color: #2c3e50;">üîñ CanuckDogs Auto-Extractor Bookmarklet</h2>
                    
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 20px 0;">
                        <h3 style="margin-bottom: 10px; color: #495057;">üìã Setup Steps:</h3>
                        <ol style="padding-left: 20px; line-height: 1.6;">
                            <li>Copy ALL the code below</li>
                            <li>Right-click your bookmarks bar ‚Üí "Add page"</li>
                            <li>Name: "Extract CanuckDogs"</li>
                            <li>URL: Paste the copied code</li>
                            <li>Save the bookmark</li>
                        </ol>
                    </div>
                    
                    <h3 style="margin: 20px 0 10px 0; color: #495057;">üìù Bookmarklet Code:</h3>
                    <textarea readonly style="width: 100%; height: 200px; font-family: monospace; font-size: 12px; padding: 10px; border: 1px solid #ccc; border-radius: 4px; background: #f8f9fa;">${bookmarkletCode}</textarea>
                    
                    <div style="text-align: center; margin-top: 20px;">
                        <button onclick="this.parentElement.parentElement.parentElement.remove()" style="background: #dc3545; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-size: 1rem;">
                            Close
                        </button>
                        <button onclick="navigator.clipboard.writeText('${bookmarkletCode.replace(/'/g, "\\'")}').then(() => alert('Bookmarklet copied!'))" style="background: #28a745; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-size: 1rem; margin-left: 10px;">
                            üìã Copy Code
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        // Listen for bookmarklet messages
        window.addEventListener('message', function(event) {
            if (event.data.type === 'canuckDogsData') {
                // Switch to paste method and populate data
                showImportMethod('paste');
                document.getElementById('manualDogName').value = event.data.dogName;
                document.getElementById('canuckDogsData').value = event.data.rawData;
                showSuccessMessage('Data received from bookmarklet! Click "Calculate Points" to process.');
            }
        });
        async function searchCanuckDogs() {
            const searchTerm = document.getElementById('dogName').value.trim();
            
            if (!searchTerm) {
                alert('Please enter a search term');
                return;
            }

            showLoading('Searching CanuckDogs database...');
            hideError();

            try {
                // Simulate CanuckDogs search with flexible matching
                await simulateFlexibleSearch(searchTerm);
                
            } catch (error) {
                showError(error.message);
            } finally {
                hideLoading();
            }
        }

        async function simulateFlexibleSearch(searchTerm) {
            // Simulate search delay
            await new Promise(resolve => setTimeout(resolve, 1500));
            
            const term = searchTerm.toLowerCase();
            const results = [];
            
            // Check for Miller demo - only if they actually search for parts of this name
            if (term.includes('miller') || term.includes('robel') || term.includes('portuguese') || 
                term.includes('aegean') || term.includes('h2o') || term.includes('gto')) {
                results.push({
                    name: "CAN BIS RBIS GCHB AM CH ROBEL GTO IT'S MILLER TIME AEGEAN H2O",
                    callName: "Miller",
                    owner: "Mamdouh Farag",
                    breed: "Portuguese Water Dog",
                    id: "demo_miller",
                    matchType: "Name contains search term",
                    isDemo: true,
                    confidence: 100
                });
            }
            
            // Create a realistic database of dog names that might actually exist
            const realisticDogs = [
                { name: "CH SUNNYDALE'S GOLDEN MILLER BOY", callName: "Miller", owner: "Sarah Johnson", breed: "Golden Retriever" },
                { name: "GCH GOLDCREST MILLER'S LEGACY", callName: "Legacy", owner: "Mike Wilson", breed: "Labrador Retriever" },
                { name: "AM CH RIVERSIDE BUDDY'S TRIUMPH", callName: "Buddy", owner: "Lisa Chen", breed: "German Shepherd" },
                { name: "CAN CH WILLOWBROOK LUNA'S STARLIGHT", callName: "Luna", owner: "David Brown", breed: "Border Collie" },
                { name: "GCHX MOUNTAINVIEW CHARLIE'S QUEST", callName: "Charlie", owner: "Emma Davis", breed: "Australian Shepherd" },
                { name: "CH BLUESTONE MAX'S ADVENTURE", callName: "Max", owner: "Tom Miller", breed: "Poodle" },
                { name: "GCH REGALCREST BELLA'S DREAM", callName: "Bella", owner: "Amy Wilson", breed: "Golden Retriever" },
                { name: "AM CH OAKWOOD COOPER'S JOURNEY", callName: "Cooper", owner: "James Taylor", breed: "Labrador Retriever" },
                { name: "CAN GCH PINECREST RUBY'S MAGIC", callName: "Ruby", owner: "Kate Anderson", breed: "German Shepherd" },
                { name: "CH STORMWIND TUCKER'S SPIRIT", callName: "Tucker", owner: "Steve Roberts", breed: "Border Collie" }
            ];
            
            // Only show dogs whose names actually contain the search term
            if (term.length >= 3) {
                realisticDogs.forEach((dog, index) => {
                    const nameMatch = dog.name.toLowerCase().includes(term);
                    const callNameMatch = dog.callName.toLowerCase().includes(term);
                    const ownerMatch = dog.owner.toLowerCase().includes(term);
                    
                    if (nameMatch || callNameMatch || ownerMatch) {
                        let matchType = '';
                        let confidence = 0;
                        
                        if (nameMatch && callNameMatch) {
                            matchType = 'Registered & call name match';
                            confidence = 95;
                        } else if (nameMatch) {
                            matchType = 'Registered name contains term';
                            confidence = 85;
                        } else if (callNameMatch) {
                            matchType = 'Call name match';
                            confidence = 80;
                        } else if (ownerMatch) {
                            matchType = 'Owner name match';
                            confidence = 70;
                        }
                        
                        results.push({
                            name: dog.name,
                            callName: dog.callName,
                            owner: dog.owner,
                            breed: dog.breed,
                            id: `realistic_${index}`,
                            matchType: matchType,
                            confidence: confidence,
                            isDemo: false
                        });
                    }
                });
            }
            
            // Sort by confidence
            results.sort((a, b) => b.confidence - a.confidence);
            
            // Show results
            showSearchResults(results, searchTerm);
        }

        function showSearchResults(results, searchTerm) {
            searchResults = results;
            
            if (results.length === 0) {
                const noResultsHTML = `
                    <div style="background: white; border-radius: 15px; padding: 25px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);">
                        <h2 style="color: #2c3e50; margin-bottom: 20px; border-bottom: 3px solid #3498db; padding-bottom: 10px;">
                            üîç CanuckDogs Search Results for "${searchTerm}"
                        </h2>
                        
                        <div style="border: 2px solid #dc3545; border-radius: 10px; padding: 30px; background: linear-gradient(135deg, #f8d7da, #f5c6cb); text-align: center;">
                            <h3 style="color: #721c24; margin-bottom: 15px;">‚ùå No Information Gathered</h3>
                            <p style="color: #721c24; margin-bottom: 15px;">
                                No dogs found matching "<strong>${searchTerm}</strong>" in the CanuckDogs database.
                            </p>
                            <div style="background: rgba(255,255,255,0.7); padding: 15px; border-radius: 8px; margin-top: 15px;">
                                <h4 style="color: #721c24; margin-bottom: 10px;">üí° Search Suggestions:</h4>
                                <ul style="color: #721c24; text-align: left; margin: 0; padding-left: 20px;">
                                    <li>Check the spelling of the registered name</li>
                                    <li>Try a shorter portion of the name</li>
                                    <li>Include the kennel prefix (e.g., "ROBEL")</li>
                                    <li>Try the dog's call name</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                `;
                
                document.getElementById('dashboard').innerHTML = noResultsHTML;
                showTab('dashboard');
                return;
            }
            
            const searchResultsHTML = `
                <div style="background: white; border-radius: 15px; padding: 25px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);">
                    <h2 style="color: #2c3e50; margin-bottom: 20px; border-bottom: 3px solid #3498db; padding-bottom: 10px;">
                        üîç CanuckDogs Information for "${searchTerm}"
                    </h2>
                    
                    <div style="margin-bottom: 20px; padding: 15px; background: linear-gradient(135deg, #3498db, #2980b9); color: white; border-radius: 8px;">
                        <h3 style="margin-bottom: 10px;">üìä Search Results:</h3>
                        <p style="margin: 0; line-height: 1.6;">
                            Found <strong>${results.length}</strong> match${results.length !== 1 ? 'es' : ''} in CanuckDogs database.
                            Click any result to view their complete competition history and calculate Grand Master points.
                        </p>
                    </div>
                    
                    <div style="display: grid; gap: 15px;">
                        ${results.map((result, index) => `
                            <div class="search-result-item ${result.isDemo ? 'exact-match' : ''}" onclick="selectDogFromSearch('${result.id}')"
                                 onmouseover="this.style.borderColor='#3498db'; this.style.transform='translateY(-2px)'; this.style.boxShadow='0 5px 15px rgba(52,152,219,0.3)'"
                                 onmouseout="this.style.borderColor='${result.isDemo ? '#28a745' : '#e9ecef'}'; this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                                
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                    <div>
                                        <span class="partial-match-badge">${result.confidence}% MATCH</span>
                                    </div>
                                    <div style="text-align: right; font-size: 0.9rem; color: #6c757d;">
                                        ${result.matchType}
                                    </div>
                                </div>
                                
                                <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                                    <div style="flex: 1;">
                                        <h3 style="color: #2c3e50; margin-bottom: 8px; font-size: 1.1rem; font-family: ${result.isDemo ? 'monospace' : 'inherit'};">
                                            ${result.name}
                                        </h3>
                                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px;">
                                            <div>
                                                <span style="font-weight: bold; color: #495057;">Call Name:</span>
                                                <span style="color: #6c757d;">${result.callName}</span>
                                            </div>
                                            <div>
                                                <span style="font-weight: bold; color: #495057;">Owner:</span>
                                                <span style="color: #6c757d;">${result.owner}</span>
                                            </div>
                                            <div style="grid-column: 1 / -1;">
                                                <span style="font-weight: bold; color: #495057;">Breed:</span>
                                                <span style="color: #6c757d;">${result.breed}</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="text-align: center; margin-left: 20px;">
                                        <div style="background: #17a2b8; color: white; padding: 8px 15px; border-radius: 6px; font-weight: bold; font-size: 0.9rem;">
                                            View Data
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            
            // Show in dashboard
            document.getElementById('dashboard').innerHTML = searchResultsHTML;
            showTab('dashboard');
        }

        async function selectDogFromSearch(dogId) {
            const selectedDog = searchResults.find(r => r.id === dogId);
            showLoading(`Extracting competition data for ${selectedDog.callName}...`);
            
            try {
                // Simulate extraction time
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                if (dogId === 'demo_miller') {
                    // Load demo data
                    currentDogData = mockCanuckDogsData;
                    calculateAllPoints();
                    displayDashboard();
                    displayYearlyBreakdown();
                    displayRawData();
                    showSuccessMessage(`Successfully loaded demo data for ${currentDogData.basicInfo.callName}!`);
                } else {
                    // Generate sample data for other selections
                    await generateSampleDataForDog(selectedDog);
                }
                
            } catch (error) {
                showError('Failed to extract data: ' + error.message);
            } finally {
                hideLoading();
            }
        }

        async function generateSampleDataForDog(dogInfo) {
            // Generate realistic sample data for non-demo dogs
            currentDogData = {
                basicInfo: {
                    registeredName: dogInfo.name,
                    callName: dogInfo.callName,
                    owner: dogInfo.owner,
                    breed: dogInfo.breed
                },
                yearlyData: {
                    2024: {
                        conformation: generateSampleShowResults(dogInfo.callName, 2024)
                    },
                    2023: {
                        conformation: generateSampleShowResults(dogInfo.callName, 2023)
                    }
                }
            };
            
            calculateAllPoints();
            displayDashboard();
            displayYearlyBreakdown();
            displayRawData();
            showSuccessMessage(`Sample data generated for ${currentDogData.basicInfo.callName}!`);
        }

        function generateSampleShowResults(callName, year) {
            const shows = [
                'Calgary Kennel & Obedience Club',
                'Regina Kennel & Obedience Club', 
                'Saskatoon Working & Herding Dog Association',
                'Hub City Kennel & Obedience Club',
                'Battle River Canine Association',
                'Assiniboine Kennel Club'
            ];
            
            const judges = [
                'Joan Luna Liebes', 'Eric Liebes (Dr)', 'Tannis Postma', 
                'Honey Glendinning', 'Robin Hughes', 'Darryl Vice'
            ];
            
            const positions = [
                'Best Of Breed', 'Winners Dog', 'Winners Bitch',
                'Group 1st', 'Group 2nd', 'Group 3rd', 'Group 4th',
                'Select Dog', 'Best Of Opposite Sex'
            ];
            
            const results = [];
            const numShows = Math.floor(Math.random() * 8) + 3; // 3-10 shows
            
            for (let i = 0; i < numShows; i++) {
                const show = shows[Math.floor(Math.random() * shows.length)];
                const judge = judges[Math.floor(Math.random() * judges.length)];
                const position = positions[Math.floor(Math.random() * positions.length)];
                const month = Math.floor(Math.random() * 12) + 1;
                const day = Math.floor(Math.random() * 28) + 1;
                
                let dogsBeaten = 0;
                let rawPoints = "N/A";
                
                // Calculate realistic dogs beaten based on position
                if (position.includes('Breed') || position.includes('Winners')) {
                    dogsBeaten = Math.floor(Math.random() * 8) + 1; // 1-8 dogs
                    rawPoints = `${Math.min(dogsBeaten, 5)} (1-1-${Math.min(dogsBeaten-1, 3)}-${Math.max(0, dogsBeaten-3)})`;
                } else if (position.includes('Group')) {
                    dogsBeaten = Math.floor(Math.random() * 25) + 5; // 5-30 dogs  
                    rawPoints = dogsBeaten.toString();
                }
                
                results.push({
                    show: show,
                    dateRange: `${getMonthName(month)} ${day}, ${year}`,
                    day: ['Saturday', 'Sunday'][Math.floor(Math.random() * 2)],
                    position: position,
                    judge: judge,
                    rawPoints: rawPoints,
                    dogsBeaten: dogsBeaten
                });
            }
            
            return results;
        }

        function getMonthName(month) {
            const months = ['January', 'February', 'March', 'April', 'May', 'June',
                          'July', 'August', 'September', 'October', 'November', 'December'];
            return months[month - 1];
        }

        // CKC Grand Master Points Formula Implementation
        function calculateGrandMasterPoints(showResult) {
            const { position, judge, dogsBeaten, category, rawPoints } = showResult;
            let points = 0;
            let calculationSteps = [];
            
            const actualDogsBeaten = dogsBeaten || extractDogsBeatenFromPoints(rawPoints);
            
            // Base points for breed competition
            if (position.toLowerCase().includes('best of breed') || 
                position.toLowerCase().includes('bob')) {
                const breedPoints = Math.min(actualDogsBeaten, 5);
                points += breedPoints;
                calculationSteps.push(`BOB: min(${actualDogsBeaten}, 5) = ${breedPoints}`);
            }
            else if (position.toLowerCase().includes('winners dog') || 
                     position.toLowerCase().includes('winners bitch') ||
                     position.toLowerCase().includes('wd') ||
                     position.toLowerCase().includes('wb')) {
                const breedPoints = Math.min(actualDogsBeaten, 5);
                points += breedPoints;
                calculationSteps.push(`WD/WB: min(${actualDogsBeaten}, 5) = ${breedPoints}`);
            }
            
            // Group placement points (additional to breed points)
            if (position.toLowerCase().includes('group 1') || 
                position.toLowerCase().includes('g1') ||
                position.toLowerCase().includes('group 1st')) {
                const groupPoints = Math.min(actualDogsBeaten * 2, 40);
                points += groupPoints;
                calculationSteps.push(`G1 Bonus: min(${actualDogsBeaten} √ó 2, 40) = ${groupPoints}`);
            }
            else if (position.toLowerCase().includes('group 2') || 
                     position.toLowerCase().includes('g2') ||
                     position.toLowerCase().includes('group 2nd')) {
                const groupPoints = Math.min(Math.floor(actualDogsBeaten * 1.5), 30);
                points += groupPoints;
                calculationSteps.push(`G2 Bonus: min(${actualDogsBeaten} √ó 1.5, 30) = ${groupPoints}`);
            }
            else if (position.toLowerCase().includes('group 3') || 
                     position.toLowerCase().includes('g3') ||
                     position.toLowerCase().includes('group 3rd')) {
                const groupPoints = Math.min(actualDogsBeaten, 20);
                points += groupPoints;
                calculationSteps.push(`G3 Bonus: min(${actualDogsBeaten} √ó 1, 20) = ${groupPoints}`);
            }
            else if (position.toLowerCase().includes('group 4') || 
                     position.toLowerCase().includes('g4') ||
                     position.toLowerCase().includes('group 4th')) {
                const groupPoints = Math.min(Math.floor(actualDogsBeaten * 0.5), 10);
                points += groupPoints;
                calculationSteps.push(`G4 Bonus: min(${actualDogsBeaten} √ó 0.5, 10) = ${groupPoints}`);
            }
            
            // Best in Show points (additional to all previous)
            if (position.toLowerCase().includes('best in show') || 
                position.toLowerCase().includes('bis')) {
                const bisPoints = Math.min(actualDogsBeaten * 5, 200);
                points += bisPoints;
                calculationSteps.push(`BIS Bonus: min(${actualDogsBeaten} √ó 5, 200) = ${bisPoints}`);
            }
            
            // Specialty show multiplier
            let specialtyMultiplier = 1;
            if (showResult.show && showResult.show.toLowerCase().includes('specialty')) {
                specialtyMultiplier = 1.5;
                calculationSteps.push(`Specialty Bonus: √ó1.5`);
            }
            
            const finalPoints = Math.round(points * specialtyMultiplier);
            
            // If no points earned, show why
            if (finalPoints === 0) {
                if (position.toLowerCase().includes('select') || position.toLowerCase().includes('opposite')) {
                    calculationSteps.push(`${position}: 0 points (no championship points awarded)`);
                } else if (actualDogsBeaten === 0) {
                    calculationSteps.push(`${position}: 0 points (no dogs defeated)`);
                } else {
                    calculationSteps.push(`${position}: 0 points (non-point earning placement)`);
                }
            }
            
            return {
                points: finalPoints,
                calculation: calculationSteps.join(' + '),
                dogsBeaten: actualDogsBeaten,
                breakdown: calculationSteps
            };
        }

        function extractDogsBeatenFromPoints(rawPoints) {
            if (!rawPoints || rawPoints === 'N/A') return 0;
            
            // Extract from formats like "13", "4 (1-1-2-1)", etc.
            const match = rawPoints.match(/(\d+)/);
            return match ? parseInt(match[1]) : 0;
        }

        // Demo data (Miller)
        const mockCanuckDogsData = {
            basicInfo: {
                registeredName: "CAN BIS RBIS GCHB AM CH ROBEL GTO IT'S MILLER TIME AEGEAN H2O",
                callName: "Miller",
                owner: "Mamdouh Farag",
                breed: "Portuguese Water Dog"
            },
            yearlyData: {
                2024: {
                    conformation: [
                        // Regina Kennel & Obedience Club
                        { show: "Regina Kennel & Obedience Club", dateRange: "May 18 to May 19, 2024", day: "Sunday", position: "Group 3rd", judge: "Tannis Postma", rawPoints: "13", dogsBeaten: 6 },
                        { show: "Regina Kennel & Obedience Club", dateRange: "May 18 to May 19, 2024", day: "Sunday", position: "Best Of Breed", judge: "Tannis Postma", rawPoints: "4 (1-1-2-1)", dogsBeaten: 5 },
                        { show: "Regina Kennel & Obedience Club", dateRange: "May 18 to May 19, 2024", day: "Saturday", position: "Best Of Breed", judge: "Honey Glendinning", rawPoints: "4 (1-1-2-1)", dogsBeaten: 5 },
                        { show: "Regina Kennel & Obedience Club", dateRange: "May 18 to May 19, 2024", day: "Saturday", position: "Select Dog", judge: "Sharon Derrick", rawPoints: "N/A", dogsBeaten: 0 },
                        
                        // Calgary Kennel & Obedience Club
                        { show: "Calgary Kennel & Obedience Club", dateRange: "May 10 to May 12, 2024", day: "Sunday", position: "Best Of Breed", judge: "Eric Liebes (Dr)", rawPoints: "0", dogsBeaten: 0 },
                        { show: "Calgary Kennel & Obedience Club", dateRange: "May 10 to May 12, 2024", day: "Saturday", position: "Group 1st", judge: "Joan Luna Liebes", rawPoints: "64", dogsBeaten: 32 },
                        { show: "Calgary Kennel & Obedience Club", dateRange: "May 10 to May 12, 2024", day: "Saturday", position: "Best Of Breed", judge: "Joan Luna Liebes", rawPoints: "0", dogsBeaten: 0 },
                        { show: "Calgary Kennel & Obedience Club", dateRange: "May 10 to May 12, 2024", day: "Saturday", position: "Best Of Breed", judge: "Catherine Barlow", rawPoints: "0", dogsBeaten: 0 },
                        { show: "Calgary Kennel & Obedience Club", dateRange: "May 10 to May 12, 2024", day: "Friday", position: "Best Of Breed", judge: "Robin Hughes", rawPoints: "0", dogsBeaten: 0 },
                        
                        // Additional shows
                        { show: "Hub City Kennel & Obedience Club", dateRange: "May 3 to May 5, 2024", day: "Sunday", position: "Group 3rd", judge: "Darryl Vice", rawPoints: "44", dogsBeaten: 22 },
                        { show: "Battle River Canine Association", dateRange: "March 22 to March 24, 2024", day: "Sunday", position: "Group 3rd", judge: "Mario Knoll", rawPoints: "49", dogsBeaten: 25 }
                    ]
                },
                2023: {
                    conformation: [
                        { show: "National Capital Kennel Club", dateRange: "September 15, 2023", day: "Saturday", position: "Best Of Winners", judge: "Dr. Michael Brown", dogsBeaten: 15, rawPoints: "8" },
                        { show: "Montreal Dog Show", dateRange: "August 20, 2023", day: "Sunday", position: "Winners Dog", judge: "Janet Rogers", dogsBeaten: 12, rawPoints: "6" }
                    ]
                }
            }
        };

        function calculateAllPoints() {
            let totalPoints = 0;
            
            Object.keys(currentDogData.yearlyData).forEach(year => {
                const yearData = currentDogData.yearlyData[year];
                let yearPoints = 0;
                
                Object.keys(yearData).forEach(category => {
                    if (Array.isArray(yearData[category])) {
                        yearData[category].forEach(result => {
                            const calculationResult = calculateGrandMasterPoints(result);
                            result.grandMasterPoints = calculationResult.points;
                            result.calculation = calculationResult.calculation;
                            result.dogsBeaten = calculationResult.dogsBeaten;
                            result.calculationBreakdown = calculationResult.breakdown;
                            yearPoints += calculationResult.points;
                            totalPoints += calculationResult.points;
                        });
                    }
                });
                
                currentDogData.yearlyData[year].totalPoints = yearPoints;
            });
            
            currentDogData.totalGrandMasterPoints = totalPoints;
        }

        function displayDashboard() {
            // Update dog info
            document.getElementById('dogInfo').style.display = 'block';
            document.getElementById('dogTitle').textContent = currentDogData.basicInfo.callName;
            document.getElementById('dogDetails').textContent = 
                `${currentDogData.basicInfo.registeredName} - Owner: ${currentDogData.basicInfo.owner}`;
            
            // Update total points
            document.getElementById('totalPoints').textContent = currentDogData.totalGrandMasterPoints;
            
            // Update title progress
            updateTitleProgress(currentDogData.totalGrandMasterPoints);
            
            // Display recent results
            displayRecentResults();
            displayPointsSummary();
        }

        function updateTitleProgress(totalPoints) {
            const titles = [
                { id: 'gchStatus', threshold: 20, name: 'GCH' },
                { id: 'gchxStatus', threshold: 100, name: 'GCHX' },
                { id: 'gmStatus', threshold: 200, name: 'GM' },
                { id: 'gmsStatus', threshold: 400, name: 'GMS' }
            ];
            
            titles.forEach(title => {
                const element = document.getElementById(title.id);
                if (totalPoints >= title.threshold) {
                    element.textContent = '‚úì';
                    element.className = 'title-achieved';
                } else {
                    const needed = title.threshold - totalPoints;
                    element.textContent = `${needed} pts needed`;
                    element.className = needed <= 20 ? 'title-current' : '';
                }
            });
        }

        function displayRecentResults() {
            const allResults = [];
            
            Object.keys(currentDogData.yearlyData).forEach(year => {
                const yearData = currentDogData.yearlyData[year];
                Object.keys(yearData).forEach(category => {
                    if (Array.isArray(yearData[category])) {
                        yearData[category].forEach(result => {
                            allResults.push({...result, year, category});
                        });
                    }
                });
            });
            
            // Sort by date (newest first)
            allResults.sort((a, b) => new Date(b.dateRange) - new Date(a.dateRange));
            
            const recentResults = allResults.slice(0, 8); // Show 8 most recent
            
            const container = document.getElementById('recentResults');
            container.innerHTML = recentResults.map(result => `
                <div class="show-result ${result.grandMasterPoints > 0 ? 'points-earned' : 'no-points'}">
                    <div class="show-header">
                        <div class="show-name">${result.show}</div>
                        <div class="show-date">${result.dateRange}</div>
                    </div>
                    <div class="show-details">
                        <div class="detail-item">
                            <span class="detail-label">Day</span>
                            ${result.day}
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Position</span>
                            ${result.position}
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Judge</span>
                            ${result.judge}
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Dogs Beat</span>
                            ${result.dogsBeaten || 0}
                        </div>
                    </div>
                    <div class="points-calculation">
                        <strong>Grand Master Points Earned: ${result.grandMasterPoints}</strong>
                        <div class="calculation-formula">
                            ${result.calculation || 'No points calculation available'}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function displayPointsSummary() {
            const yearlyTotals = {};
            let totalShows = 0;
            let pointsEarned = 0;
            
            Object.keys(currentDogData.yearlyData).forEach(year => {
                const yearData = currentDogData.yearlyData[year];
                let yearShows = 0;
                let yearPoints = 0;
                
                Object.keys(yearData).forEach(category => {
                    if (Array.isArray(yearData[category])) {
                        yearShows += yearData[category].length;
                        yearData[category].forEach(result => {
                            yearPoints += result.grandMasterPoints || 0;
                        });
                    }
                });
                
                yearlyTotals[year] = { shows: yearShows, points: yearPoints };
                totalShows += yearShows;
                pointsEarned += yearPoints;
            });
            
            const container = document.getElementById('pointsSummary');
            container.innerHTML = `
                <div style="display: grid; gap: 15px; margin-bottom: 20px;">
                    <div class="detail-item" style="text-align: center; background: linear-gradient(135deg, #17a2b8, #138496); color: white;">
                        <span class="detail-label" style="color: rgba(255,255,255,0.8);">Total Shows</span>
                        <div style="font-size: 1.5rem; font-weight: bold;">${totalShows}</div>
                    </div>
                    <div class="detail-item" style="text-align: center; background: linear-gradient(135deg, #28a745, #20b933); color: white;">
                        <span class="detail-label" style="color: rgba(255,255,255,0.8);">Points Earned</span>
                        <div style="font-size: 1.5rem; font-weight: bold;">${pointsEarned}</div>
                    </div>
                    <div class="detail-item" style="text-align: center; background: linear-gradient(135deg, #6f42c1, #563d7c); color: white;">
                        <span class="detail-label" style="color: rgba(255,255,255,0.8);">Average per Show</span>
                        <div style="font-size: 1.5rem; font-weight: bold;">${totalShows > 0 ? (pointsEarned / totalShows).toFixed(1) : 0}</div>
                    </div>
                </div>
                
                <h4 style="margin-bottom: 15px; color: #2c3e50;">Yearly Breakdown:</h4>
                ${Object.keys(yearlyTotals).map(year => `
                    <div class="detail-item" style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                        <span><strong>${year}:</strong> ${yearlyTotals[year].shows} shows</span>
                        <span style="color: #27ae60; font-weight: bold;">${yearlyTotals[year].points} points</span>
                    </div>
                `).join('')}
            `;
        }

        function displayYearlyBreakdown() {
            const years = Object.keys(currentDogData.yearlyData).sort((a, b) => b - a);
            
            const container = document.getElementById('yearlyBreakdown');
            container.innerHTML = years.map(year => `
                <div class="year-card ${selectedYear === year ? 'selected' : ''}" onclick="selectYear('${year}')">
                    <h3>${year}</h3>
                    <div class="year-points">${currentDogData.yearlyData[year].totalPoints || 0}</div>
                    <small>Grand Master Points</small>
                </div>
            `).join('');
            
            // Auto-select most recent year
            if (!selectedYear && years.length > 0) {
                selectYear(years[0]);
            }
        }

        function selectYear(year) {
            selectedYear = year;
            displayYearlyBreakdown(); // Refresh to show selection
            displayYearDetails(year);
        }

        function displayYearDetails(year) {
            const yearData = currentDogData.yearlyData[year];
            if (!yearData) return;
            
            const allResults = [];
            Object.keys(yearData).forEach(category => {
                if (Array.isArray(yearData[category])) {
                    yearData[category].forEach(result => {
                        allResults.push({...result, category});
                    });
                }
            });
            
            // Sort by date
            allResults.sort((a, b) => new Date(b.dateRange) - new Date(a.dateRange));
            
            const container = document.getElementById('selectedYearDetails');
            container.innerHTML = `
                <div class="card">
                    <h2>üìÖ ${year} Detailed Results</h2>
                    <div style="background: linear-gradient(135deg, #fd7e14, #e9630a); color: white; padding: 15px; border-radius: 8px; margin-bottom: 20px; text-align: center;">
                        <h3>Year ${year} Summary</h3>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-top: 15px;">
                            <div>
                                <div style="font-size: 1.5rem; font-weight: bold;">${allResults.length}</div>
                                <div style="opacity: 0.9;">Total Shows</div>
                            </div>
                            <div>
                                <div style="font-size: 1.5rem; font-weight: bold;">${yearData.totalPoints || 0}</div>
                                <div style="opacity: 0.9;">Points Earned</div>
                            </div>
                            <div>
                                <div style="font-size: 1.5rem; font-weight: bold;">${allResults.length > 0 ? ((yearData.totalPoints || 0) / allResults.length).toFixed(1) : 0}</div>
                                <div style="opacity: 0.9;">Avg per Show</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="show-results">
                        ${allResults.map(result => `
                            <div class="show-result ${result.grandMasterPoints > 0 ? 'points-earned' : 'no-points'}">
                                <div class="show-header">
                                    <div class="show-name">${result.show}</div>
                                    <div class="show-date">${result.dateRange}</div>
                                </div>
                                <div class="show-details">
                                    <div class="detail-item">
                                        <span class="detail-label">Day</span>
                                        ${result.day}
                                    </div>
                                    <div class="detail-item">
                                        <span class="detail-label">Position</span>
                                        ${result.position}
                                    </div>
                                    <div class="detail-item">
                                        <span class="detail-label">Judge</span>
                                        ${result.judge}
                                    </div>
                                    <div class="detail-item">
                                        <span class="detail-label">Dogs Beat</span>
                                        ${result.dogsBeaten || 0}
                                    </div>
                                    <div class="detail-item">
                                        <span class="detail-label">Category</span>
                                        ${result.category}
                                    </div>
                                </div>
                                <div class="points-calculation">
                                    <strong>Grand Master Points: ${result.grandMasterPoints}</strong>
                                    <div class="calculation-formula">
                                        ${result.calculation || 'No points earned'}
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function displayRawData() {
            const allResults = [];
            
            Object.keys(currentDogData.yearlyData).forEach(year => {
                const yearData = currentDogData.yearlyData[year];
                Object.keys(yearData).forEach(category => {
                    if (Array.isArray(yearData[category])) {
                        yearData[category].forEach(result => {
                            allResults.push({...result, year, category});
                        });
                    }
                });
            });
            
            // Sort by date (newest first)
            allResults.sort((a, b) => new Date(b.dateRange) - new Date(a.dateRange));
            
            const container = document.getElementById('rawDataTable');
            container.innerHTML = `
                <table class="canuckdogs-table">
                    <thead>
                        <tr>
                            <th>Year</th>
                            <th>Show</th>
                            <th>Date Range</th>
                            <th>Day</th>
                            <th>Position</th>
                            <th>Judge</th>
                            <th>Dogs Beat</th>
                            <th>Raw Points</th>
                            <th>GM Points</th>
                            <th>Category</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${allResults.map(result => `
                            <tr class="${result.grandMasterPoints > 0 ? 'win-highlight' : ''}">
                                <td>${result.year}</td>
                                <td>${result.show}</td>
                                <td>${result.dateRange}</td>
                                <td>${result.day}</td>
                                <td>${result.position}</td>
                                <td>${result.judge}</td>
                                <td>${result.dogsBeaten || 0}</td>
                                <td>${result.rawPoints}</td>
                                <td style="font-weight: bold; color: #27ae60;">${result.grandMasterPoints}</td>
                                <td>${result.category}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
                
                <div style="margin-top: 20px; padding: 15px; background: #e9ecef; border-radius: 8px;">
                    <h4>CanuckDogs Data Notes:</h4>
                    <ul style="margin-top: 10px; padding-left: 20px;">
                        <li><strong>Raw Points:</strong> Original points from CanuckDogs display</li>
                        <li><strong>GM Points:</strong> Calculated CKC Grand Master championship points</li>
                        <li><strong>Dogs Beat:</strong> Extracted from point calculations when available</li>
                        <li><strong>Highlighted rows:</strong> Results that earned Grand Master points</li>
                    </ul>
                </div>
            `;
        }

        function generatePDFReport(type) {
            if (!currentDogData) {
                alert('Please select a dog first');
                return;
            }
            
            // Create PDF content
            const pdfContent = generatePDFContent(type);
            
            // Create blob and download
            const blob = new Blob([pdfContent], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${currentDogData.basicInfo.callName}_${type}_report.html`;
            a.click();
            URL.revokeObjectURL(url);
            
            // Also open in new window for immediate viewing
            const newWindow = window.open('', '_blank');
            newWindow.document.write(pdfContent);
            newWindow.document.close();
        }

        function generatePDFContent(type) {
            const dog = currentDogData.basicInfo;
            const totalPoints = currentDogData.totalGrandMasterPoints;
            const currentDate = new Date().toLocaleDateString();
            
            return `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>CKC Grand Master Points Report - ${dog.callName}</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 40px; line-height: 1.6; }
                        .header { text-align: center; border-bottom: 3px solid #2c3e50; padding-bottom: 20px; margin-bottom: 30px; }
                        .header h1 { color: #2c3e50; margin-bottom: 10px; }
                        .summary { background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 30px; }
                        .points-total { font-size: 2rem; color: #27ae60; font-weight: bold; text-align: center; }
                        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                        th { background-color: #2c3e50; color: white; }
                        .points-cell { background-color: #d4edda; font-weight: bold; }
                        .formula { font-family: monospace; background: #f8f9fa; padding: 5px; }
                        .section { margin: 30px 0; }
                        .footer { margin-top: 50px; text-align: center; font-size: 0.9rem; color: #666; }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>üèÜ CKC Grand Master Championship Points Report</h1>
                        <h2>${dog.registeredName}</h2>
                        <p><strong>Call Name:</strong> ${dog.callName} | <strong>Owner:</strong> ${dog.owner}</p>
                        <p><strong>Report Generated:</strong> ${currentDate}</p>
                    </div>
                    
                    <div class="summary">
                        <h3>Championship Points Summary</h3>
                        <div class="points-total">${totalPoints} Total Grand Master Points</div>
                        <div style="text-align: center; margin-top: 15px;">
                            ${getTitleStatus(totalPoints)}
                        </div>
                    </div>
                    
                    ${generateDetailedResults()}
                    
                    <div class="section">
                        <h3>CKC Grand Master Points Formula</h3>
                        <div class="formula">
                            <strong>Base Points:</strong><br>
                            ‚Ä¢ Best of Breed/Winners Dog/Winners Bitch: min(dogs_defeated, 5)<br>
                            ‚Ä¢ Group 1st: +min(dogs_defeated √ó 2, 40)<br>
                            ‚Ä¢ Group 2nd: +min(dogs_defeated √ó 1.5, 30)<br>
                            ‚Ä¢ Group 3rd: +min(dogs_defeated √ó 1, 20)<br>
                            ‚Ä¢ Group 4th: +min(dogs_defeated √ó 0.5, 10)<br>
                            ‚Ä¢ Best in Show: +min(dogs_defeated √ó 5, 200)<br>
                            ‚Ä¢ Specialty Show Bonus: √ó1.5
                        </div>
                    </div>
                    
                    <div class="footer">
                        <p><strong>Disclaimer:</strong> This report is based on data extracted from CanuckDogs.com and calculated using official CKC Grand Master championship point formulas. Points should be verified with official CKC records for title applications.</p>
                        <p>Report generated by CKC Grand Master Points Tracker</p>
                    </div>
                </body>
                </html>
            `;
        }

        function generateDetailedResults() {
            const allResults = [];
            
            Object.keys(currentDogData.yearlyData).forEach(year => {
                const yearData = currentDogData.yearlyData[year];
                Object.keys(yearData).forEach(category => {
                    if (Array.isArray(yearData[category])) {
                        yearData[category].forEach(result => {
                            allResults.push({...result, year, category});
                        });
                    }
                });
            });
            
            allResults.sort((a, b) => new Date(b.dateRange) - new Date(a.dateRange));
            
            return `
                <div class="section">
                    <h3>Detailed Competition Results</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Show</th>
                                <th>Position</th>
                                <th>Judge</th>
                                <th>Dogs Beat</th>
                                <th>GM Points</th>
                                <th>Calculation</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${allResults.map(result => `
                                <tr>
                                    <td>${result.dateRange}</td>
                                    <td>${result.show}</td>
                                    <td>${result.position}</td>
                                    <td>${result.judge}</td>
                                    <td>${result.dogsBeaten || 0}</td>
                                    <td class="points-cell">${result.grandMasterPoints}</td>
                                    <td class="formula">${result.calculation || 'No points'}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }

        function getTitleStatus(points) {
            if (points >= 400) return "üèÜ <strong>Grand Master Supreme Eligible</strong>";
            if (points >= 200) return "ü•á <strong>Grand Master Eligible</strong>";
            if (points >= 100) return "ü•à <strong>Grand Champion Excellent Eligible</strong>";
            if (points >= 20) return "ü•â <strong>Grand Champion Eligible</strong>";
            return `üìä Working toward Grand Champion (${20 - points} points needed)`;
        }

        function showTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab content
            document.getElementById(tabName).classList.add('active');
            
            // Add active class to clicked tab
            document.querySelector(`[onclick="showTab('${tabName}')"]`).classList.add('active');
        }

        function showLoading(message = 'Processing...') {
            document.getElementById('statusText').textContent = message;
            document.getElementById('status').style.display = 'block';
        }

        function hideLoading() {
            document.getElementById('status').style.display = 'none';
        }

        function showError(message) {
            document.getElementById('errorMessage').textContent = message;
            document.getElementById('error').style.display = 'block';
            hideLoading();
        }

        function hideError() {
            document.getElementById('error').style.display = 'none';
        }

        function showSuccessMessage(message) {
            let successDiv = document.getElementById('successMessage');
            if (!successDiv) {
                successDiv = document.createElement('div');
                successDiv.id = 'successMessage';
                successDiv.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: #28a745;
                    color: white;
                    padding: 15px 25px;
                    border-radius: 8px;
                    font-size: 1rem;
                    font-weight: 600;
                    box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
                    z-index: 1000;
                    display: none;
                `;
                document.body.appendChild(successDiv);
            }
            
            successDiv.textContent = message;
            successDiv.style.display = 'block';
            
            // Hide after 4 seconds
            setTimeout(() => {
                successDiv.style.display = 'none';
            }, 4000);
        }

        // Enter key support
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('dogName').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    searchCanuckDogs();
                }
            });
            document.getElementById('dogName').focus();
        });
    </script>
</body>
</html>
